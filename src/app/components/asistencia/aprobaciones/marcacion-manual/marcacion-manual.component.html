<!-- Header principal con tema Fiori -->
<div class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border mb-4 overflow-hidden">
  <!-- Header -->
  <div class="px-4 py-3 border-b border-fiori-border bg-fiori-muted">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-fiori-primary/10 rounded-lg flex items-center justify-center">
          <lucide-icon name="clock" class="w-5 h-5 text-fiori-primary"></lucide-icon>
        </div>
        <div>
          <h1 class="text-lg font-semibold text-fiori-text">Marcaciones Manuales</h1>
          <p class="text-sm text-fiori-subtext">Gestión y aprobación de marcaciones manuales</p>
        </div>
      </div>
    </div>
    
    <!-- Botón de acción compacto -->
    <div class="mt-3 pt-3 border-t border-fiori-border">
      <button 
        (click)="registrarNuevaMarcacionManual()"
        class="inline-flex items-center gap-2 px-3 py-1.5 bg-fiori-primary text-white text-sm font-medium rounded-lg hover:bg-fiori-secondary focus:outline-none focus:ring-2 focus:ring-fiori-primary focus:ring-offset-1 transition-colors">
        <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
        Nueva Marcación Manual
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="p-4">
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2">
        <lucide-icon name="filter" class="w-4 h-4 text-fiori-primary"></lucide-icon>
        <span class="text-sm font-medium text-fiori-text">Filtros:</span>
      </div>
      
      <!-- Filtro por número de documento -->
      <div class="relative max-w-xs">
        <input
          type="text"
          [(ngModel)]="filtroNroDoc"
          placeholder="Buscar por documento..."
          (keyup.enter)="buscarPorNroDoc()"
          class="w-full pl-10 pr-10 py-2 text-sm border border-fiori-border rounded-lg bg-fiori-surface focus:ring-2 focus:ring-fiori-primary focus:border-fiori-primary transition-all">
        <lucide-icon name="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-fiori-subtext w-4 h-4"></lucide-icon>
        <button 
          *ngIf="filtroNroDoc" 
          (click)="limpiarFiltro()" 
          class="absolute right-3 top-1/2 transform -translate-y-1/2 text-fiori-subtext hover:text-fiori-error transition-colors">
          <lucide-icon name="x" class="w-4 h-4"></lucide-icon>
        </button>
      </div>

      <!-- Botón de búsqueda -->
      <button 
        (click)="buscarPorNroDoc()"
        class="inline-flex items-center gap-2 px-3 py-2 text-sm bg-fiori-primary text-white rounded-lg hover:bg-fiori-secondary focus:ring-2 focus:ring-fiori-primary focus:ring-offset-1 transition-colors">
        <lucide-icon name="search" class="w-4 h-4"></lucide-icon>
        Buscar
      </button>
    </div>
  </div>
</div>

<!-- Loading indicator con tema Fiori -->
<div *ngIf="isLoading" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border p-8 mb-4">
  <div class="flex flex-col items-center justify-center">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-fiori-primary mb-4"></div>
    <p class="text-fiori-subtext">Cargando marcaciones manuales...</p>
  </div>
</div>

<!-- Error message con tema Fiori -->
<div *ngIf="errorMessage && !isLoading" class="bg-fiori-error/10 border border-fiori-error/20 text-fiori-error px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="alert-circle" class="w-5 h-5"></lucide-icon>
  <span>{{ errorMessage }}</span>
</div>

<!-- Success message con tema Fiori -->
<div *ngIf="successMessage && !isLoading" class="bg-fiori-success/10 border border-fiori-success/20 text-fiori-success px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="check-circle" class="w-5 h-5"></lucide-icon>
  <span>{{ successMessage }}</span>
</div>

<div class="mb-5" *ngIf="!isLoading">
  <!-- Tabla con tema Fiori ---->
  <div class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-fiori-muted border-b border-fiori-border">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-fiori-subtext uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <lucide-icon name="id-card" class="w-4 h-4"></lucide-icon>
                Documento
              </div>
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-fiori-subtext uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <lucide-icon name="calendar-range" class="w-4 h-4"></lucide-icon>
                Fecha/Hora
              </div>
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-fiori-subtext uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <lucide-icon name="log-in" class="w-4 h-4"></lucide-icon>
                Estado
              </div>
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-fiori-subtext uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <lucide-icon name="file-text" class="w-4 h-4"></lucide-icon>
                Motivo
              </div>
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-fiori-subtext uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <lucide-icon name="check-circle" class="w-4 h-4"></lucide-icon>
                Aplicado
              </div>
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-fiori-subtext uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <lucide-icon name="eye" class="w-4 h-4"></lucide-icon>
                Auditado
              </div>
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-fiori-subtext uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <lucide-icon name="settings" class="w-4 h-4"></lucide-icon>
                Acciones
              </div>
            </th>
          </tr>
        </thead>
        <tbody class="bg-fiori-surface divide-y divide-fiori-border">
          <tr *ngFor="let item of marcacionesManuales" class="hover:bg-fiori-hover transition-colors duration-200">
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-fiori-primary/10 rounded-lg flex items-center justify-center">
                  <lucide-icon name="user" class="w-4 h-4 text-fiori-primary"></lucide-icon>
                </div>
                <span class="text-sm font-medium text-fiori-text">{{ item.nroDoc }}</span>
              </div>
            </td>
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2">
                <lucide-icon name="clock" class="w-4 h-4 text-fiori-primary"></lucide-icon>
                <span class="text-sm text-fiori-text">{{ item.punchTime | date:'yyyy-MM-dd HH:mm:ss' }}</span>
              </div>
            </td>
            <td class="px-4 py-4 whitespace-nowrap">
              <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium"
                    [class]="item.punchState === 0 ? 'bg-fiori-success/10 text-fiori-success border border-fiori-success/20' : 'bg-fiori-error/10 text-fiori-error border border-fiori-error/20'">
                <lucide-icon [name]="item.punchState === 0 ? 'log-in' : 'log-out'" class="w-3 h-3"></lucide-icon>
                <ng-container *ngIf="item.punchState === 0; else esSalidaManual">
                  Entrada
                </ng-container>
                <ng-template #esSalidaManual>Salida</ng-template>
              </span>
            </td>
            <td class="px-4 py-4">
              <span class="text-sm text-fiori-text">{{ item.applyReason }}</span>
            </td>
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2" *ngIf="item.applyTime; else noAplicado">
                <lucide-icon name="check-circle" class="w-4 h-4 text-fiori-success"></lucide-icon>
                <span class="text-sm text-fiori-text">{{ item.applyTime | date:'yyyy-MM-dd HH:mm:ss' }}</span>
              </div>
              <ng-template #noAplicado>
                <span class="text-sm text-fiori-subtext italic">No aplicado</span>
              </ng-template>
            </td>
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2" *ngIf="item.auditTime; else noAuditado">
                <lucide-icon name="eye" class="w-4 h-4 text-fiori-warning"></lucide-icon>
                <span class="text-sm text-fiori-text">{{ item.auditTime | date:'yyyy-MM-dd HH:mm:ss' }}</span>
              </div>
              <ng-template #noAuditado>
                <span class="text-sm text-fiori-subtext italic">No auditado</span>
              </ng-template>
            </td>
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center gap-2">
                <!-- Botón Editar -->
                <button 
                  class="inline-flex items-center px-3 py-2 text-sm bg-fiori-surface border border-fiori-border rounded-lg hover:bg-fiori-hover hover:border-fiori-primary transition-all duration-200 group"
                  title="Editar marcación"
                  (click)="editarMarcacionManual(item.manualLogId)">
                  <lucide-icon name="edit" class="w-4 h-4 text-fiori-primary group-hover:text-fiori-secondary"></lucide-icon>
                </button>
                <!-- Botón Eliminar -->
                <button 
                data-modal-target="popup-modal" data-modal-toggle="popup-modal"
                  class="inline-flex items-center px-3 py-2 text-sm bg-fiori-surface border border-fiori-border rounded-lg hover:bg-fiori-error/10 hover:border-fiori-error transition-all duration-200 group"
                  title="Eliminar marcación">
                  <lucide-icon name="trash-2" class="w-4 h-4 text-fiori-error group-hover:text-fiori-error"></lucide-icon>
                </button>
              </div>
            </td>
          </tr>
          <!-- Estado vacío con tema Fiori -->
          <tr *ngIf="!marcacionesManuales || marcacionesManuales.length === 0">
            <td colspan="7" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center">
                <div class="w-16 h-16 bg-fiori-muted rounded-full flex items-center justify-center mb-4">
                  <lucide-icon name="database" class="w-8 h-8 text-fiori-subtext"></lucide-icon>
                </div>
                <h3 class="text-lg font-medium text-fiori-text mb-2">No hay marcaciones manuales</h3>
                <p class="text-sm text-fiori-subtext mb-4">No se encontraron registros para mostrar</p>
                <button 
                  (click)="registrarNuevaMarcacionManual()"
                  class="inline-flex items-center gap-2 px-4 py-2 bg-fiori-primary text-white text-sm font-medium rounded-lg hover:bg-fiori-secondary transition-colors">
                  <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
                  Crear Primera Marcación
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Paginación con tema Fiori -->

   <app-fiori-paginator
      [totalRecords]="totalRecords"
      [pageSize]="pageSize"
      [pageNumber]="pageNumber"
      [pageSizeOptions]="[5, 10, 25, 50]"
      [showAllOption]="true"
      [loading]="false"
      (pageChange)="onPageChangeCustom($event)">
    </app-fiori-paginator>


  <div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow-sm dark:bg-gray-700">
            <button type="button" class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="popup-modal">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="p-4 md:p-5 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">¿Estás seguro de eliminar esta marcación?</h3>
                <button data-modal-hide="popup-modal" type="button" class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center">
                    Si, eliminar
                </button>
                <button data-modal-hide="popup-modal" type="button" class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">No, cancelar</button>
            </div>
        </div>
    </div>
</div>

</div>
