<!-- Container principal con tema Fiori -->
<div class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border mb-4 overflow-hidden">
  
  <!-- Header del componente -->
  <div class="px-6 py-4 border-b border-fiori-border bg-fiori-muted">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-fiori-primary/10 rounded-lg flex items-center justify-center">
          <lucide-icon name="calendar-days" class="w-6 h-6 text-fiori-primary"></lucide-icon>
        </div>
        <div>
          <h1 class="text-xl font-semibold text-fiori-text">Gestión de Feriados</h1>
          <p class="text-sm text-fiori-subtext">Visualización y sincronización de días festivos</p>
          <!-- Estadísticas rápidas -->
          <div *ngIf="holidayStats.totalHolidays" class="text-xs text-fiori-primary mt-1 flex items-center gap-4">
            <span>
              <lucide-icon name="calendar" class="w-3 h-3 inline mr-1"></lucide-icon>
              Total: {{ holidayStats.totalHolidays }}
            </span>
            <span>
              <lucide-icon name="star" class="w-3 h-3 inline mr-1"></lucide-icon>
              {{ currentYear }}: {{ holidayStats.currentYearHolidays }}
            </span>
            <span>
              <lucide-icon name="trending-up" class="w-3 h-3 inline mr-1"></lucide-icon>
              {{ holidayStats.totalYears }} años
            </span>
          </div>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <!-- Botón para ajustar columnas -->
        <button 
          type="button"
          (click)="autoSizeColumns()"
          [disabled]="isLoading || !filteredRowData.length"
          class="inline-flex items-center gap-2 px-3 py-2 bg-fiori-info text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-fiori-info focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon name="columns" class="w-4 h-4"></lucide-icon>
          <span>Ajustar</span>
        </button>

        <!-- Botón exportar CSV -->
        <button 
          type="button"
          (click)="exportToCsv()"
          [disabled]="isLoading || !filteredRowData.length"
          class="inline-flex items-center gap-2 px-3 py-2 bg-fiori-success text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-fiori-success focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon name="download" class="w-4 h-4"></lucide-icon>
          <span>CSV</span>
        </button>
        
        <!-- Botón de sincronización -->
        <button 
          type="button"
          (click)="synchronizeData()"
          [disabled]="isSynchronizing"
          class="inline-flex items-center gap-2 px-4 py-2 bg-fiori-warning text-white text-sm font-medium rounded-lg hover:bg-orange-600 focus:ring-2 focus:ring-fiori-warning focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon [name]="isSynchronizing ? 'refresh-cw' : 'refresh-ccw'" 
                       [class]="isSynchronizing ? 'w-4 h-4 animate-spin' : 'w-4 h-4'"></lucide-icon>
          <span>{{ isSynchronizing ? 'Sincronizando...' : 'Sincronizar' }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Formulario de filtros compacto -->
  <form [formGroup]="filterForm" class="p-4 bg-fiori-surface">
    <div class="flex flex-wrap items-end gap-4 mb-4">
      
      <!-- Filtro por año -->
      <div class="flex-1 min-w-[160px]">
        <label class="block text-xs font-medium text-fiori-text mb-1">
          <lucide-icon name="calendar-range" class="w-3 h-3 inline mr-1"></lucide-icon>
          Filtrar por Año
        </label>
        <select 
          formControlName="yearFilter"
          class="w-full px-3 py-2 text-sm border border-fiori-border rounded-md bg-fiori-surface text-fiori-text focus:ring-1 focus:ring-fiori-primary focus:border-fiori-primary transition-all">
          <option value="all">Todos los años</option>
          <option *ngFor="let year of availableYears" [value]="year">
            {{ year }}{{ year == currentYear.toString() ? ' (Actual)' : '' }}
          </option>
        </select>
      </div>

      <!-- Búsqueda -->
      <div class="flex-1 min-w-[200px]">
        <label class="block text-xs font-medium text-fiori-text mb-1">
          <lucide-icon name="search" class="w-3 h-3 inline mr-1"></lucide-icon>
          Buscar en Descripción
        </label>
        <div class="relative">
          <input 
            type="text" 
            formControlName="searchTerm"
            placeholder="Buscar feriados..."
            class="w-full px-3 py-2 pl-8 text-sm border border-fiori-border rounded-md bg-fiori-surface text-fiori-text focus:ring-1 focus:ring-fiori-primary focus:border-fiori-primary transition-all">
          <div class="absolute left-2 top-1/2 transform -translate-y-1/2">
            <lucide-icon name="search" class="w-3 h-3 text-fiori-subtext"></lucide-icon>
          </div>
        </div>
      </div>

      <!-- Toggle año actual -->
      <div class="flex items-center gap-2">
        <label class="inline-flex items-center">
          <input 
            type="checkbox" 
            formControlName="showCurrentYearOnly"
            class="w-4 h-4 text-fiori-primary border-fiori-border rounded focus:ring-fiori-primary focus:ring-2">
          <span class="ml-2 text-sm font-medium text-fiori-text">Solo {{ currentYear }}</span>
        </label>
      </div>

      <!-- Botones de acción -->
      <div class="flex items-center gap-2">
        <button 
          type="button"
          (click)="onClearFilters()"
          class="inline-flex items-center gap-1 px-3 py-2 bg-fiori-muted text-fiori-subtext text-sm font-medium rounded-md hover:bg-fiori-hover transition-colors">
          <lucide-icon name="x-circle" class="w-3 h-3"></lucide-icon>
          <span class="hidden sm:inline">Limpiar</span>
        </button>

        <button 
          type="button"
          (click)="loadHolidays()"
          [disabled]="isLoading"
          class="inline-flex items-center gap-1 px-4 py-2 bg-fiori-primary text-white text-sm font-medium rounded-md hover:bg-fiori-secondary focus:ring-1 focus:ring-fiori-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon [name]="isLoading ? 'refresh-cw' : 'refresh'" 
                       [class]="isLoading ? 'w-3 h-3 animate-spin' : 'w-3 h-3'"></lucide-icon>
          <span class="hidden sm:inline">{{ isLoading ? 'Cargando...' : 'Actualizar' }}</span>
        </button>
      </div>
    </div>
  </form>
</div>

<!-- Mensajes de estado -->
<div *ngIf="errorMessage && !isLoading" class="bg-fiori-error/10 border border-fiori-error/20 text-fiori-error px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="alert-circle" class="w-5 h-5"></lucide-icon>
  <span>{{ errorMessage }}</span>
</div>

<div *ngIf="successMessage && !isLoading && !isSynchronizing" class="bg-fiori-success/10 border border-fiori-success/20 text-fiori-success px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="check-circle" class="w-5 h-5"></lucide-icon>
  <span>{{ successMessage }}</span>
</div>

<!-- Loading indicator -->
<div *ngIf="isLoading" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border p-8 mb-4">
  <div class="flex flex-col items-center justify-center">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-fiori-primary mb-4"></div>
    <p class="text-fiori-subtext">Cargando feriados...</p>
  </div>
</div>

<!-- Indicador de sincronización -->
<div *ngIf="isSynchronizing" class="bg-fiori-warning/10 border border-fiori-warning/20 text-fiori-warning px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="refresh-cw" class="w-5 h-5 animate-spin"></lucide-icon>
  <span>Sincronizando datos desde API externa...</span>
</div>

<!-- AG-Grid Tabla -->
<div *ngIf="!isLoading && filteredRowData.length > 0" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border overflow-hidden">
  
  <!-- Header de la tabla -->
  <div class="px-4 py-3 border-b border-fiori-border bg-fiori-muted">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-fiori-text">
        Lista de Feriados
        <span class="text-sm font-normal text-fiori-subtext ml-2">
          ({{ filteredRowData.length }} registro{{ filteredRowData.length !== 1 ? 's' : '' }})
        </span>
      </h3>
      <div class="text-sm text-fiori-subtext">
        Última actualización: {{ currentDate | date:'dd/MM/yyyy HH:mm:ss' }}
      </div>
    </div>
  </div>

  <!-- AG-Grid Container -->
  <div class="ag-theme-alpine" style="height: 600px; width: 100%;">
    <ag-grid-angular
      #agGrid
      [columnDefs]="columnDefs"
      [rowData]="filteredRowData"
      [gridOptions]="gridOptions"
      style="height: 100%; width: 100%;">
    </ag-grid-angular>
  </div>

  <!-- Footer con estadísticas -->
  <div class="border-t border-fiori-border bg-fiori-muted/30 px-4 py-3" 
       *ngIf="holidayStats.totalHolidays">
    <div class="flex items-center justify-between text-sm">
      <div class="flex items-center gap-6">
        <span class="text-fiori-text">
          <strong>Total feriados:</strong> {{ holidayStats.totalHolidays }}
        </span>
        <span class="text-fiori-info">
          <strong>Año actual ({{ currentYear }}):</strong> {{ holidayStats.currentYearHolidays }}
        </span>
        <span class="text-fiori-warning">
          <strong>Años disponibles:</strong> {{ holidayStats.totalYears }}
        </span>
        <span class="text-fiori-success">
          <strong>Promedio por año:</strong> {{ holidayStats.averagePerYear }}
        </span>
      </div>
      <div class="text-fiori-subtext">
        Mostrando: {{ filteredRowData.length }} de {{ holidayStats.totalHolidays }}
      </div>
    </div>
  </div>
</div>

<!-- Estado vacío -->
<div *ngIf="!isLoading && filteredRowData.length === 0 && rowData.length > 0" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border p-12 text-center">
  <div class="flex flex-col items-center">
    <div class="w-20 h-20 bg-fiori-muted rounded-full flex items-center justify-center mb-4">
      <lucide-icon name="search-x" class="w-10 h-10 text-fiori-subtext"></lucide-icon>
    </div>
    <h3 class="text-lg font-medium text-fiori-text mb-2">No se encontraron feriados</h3>
    <p class="text-sm text-fiori-subtext mb-6">
      Ajusta los filtros para ver más resultados
    </p>
    <button 
      type="button"
      (click)="onClearFilters()"
      class="inline-flex items-center gap-2 px-6 py-3 bg-fiori-primary text-white text-sm font-medium rounded-lg hover:bg-fiori-secondary transition-colors">
      <lucide-icon name="refresh-cw" class="w-4 h-4"></lucide-icon>
      Limpiar Filtros
    </button>
  </div>
</div>

<!-- Estado completamente vacío -->
<div *ngIf="!isLoading && rowData.length === 0" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border p-12 text-center">
  <div class="flex flex-col items-center">
    <div class="w-20 h-20 bg-fiori-muted rounded-full flex items-center justify-center mb-4">
      <lucide-icon name="calendar-x" class="w-10 h-10 text-fiori-subtext"></lucide-icon>
    </div>
    <h3 class="text-lg font-medium text-fiori-text mb-2">No hay feriados disponibles</h3>
    <p class="text-sm text-fiori-subtext mb-6">
      Sincroniza los datos para cargar los feriados desde la API externa
    </p>
    <button 
      type="button"
      (click)="synchronizeData()"
      [disabled]="isSynchronizing"
      class="inline-flex items-center gap-2 px-6 py-3 bg-fiori-warning text-white text-sm font-medium rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50">
      <lucide-icon [name]="isSynchronizing ? 'refresh-cw' : 'refresh-ccw'" 
                   [class]="isSynchronizing ? 'w-4 h-4 animate-spin' : 'w-4 h-4'"></lucide-icon>
      {{ isSynchronizing ? 'Sincronizando...' : 'Sincronizar Datos' }}
    </button>
  </div>
</div>