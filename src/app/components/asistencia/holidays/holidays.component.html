<!-- Container principal con tema Fiori -->
<div class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border mb-4 overflow-hidden">
  
  <!-- Header del componente -->
  <div class="px-6 py-4 border-b border-fiori-border bg-fiori-muted">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-fiori-primary/10 rounded-lg flex items-center justify-center">
          <lucide-icon name="calendar-days" class="w-6 h-6 text-fiori-primary"></lucide-icon>
        </div>
        <div>
          <h1 class="text-xl font-semibold text-fiori-text">Gestión de Feriados</h1>
          <p class="text-sm text-fiori-subtext">Visualización y sincronización de días festivos</p>
          <!-- Estadísticas rápidas -->
          <div *ngIf="holidayStats.totalHolidays" class="text-xs text-fiori-primary mt-1 flex items-center gap-4">
            <span>
              <lucide-icon name="calendar" class="w-3 h-3 inline mr-1"></lucide-icon>
              Total: {{ holidayStats.totalHolidays }}
            </span>
            <span>
              <lucide-icon name="star" class="w-3 h-3 inline mr-1"></lucide-icon>
              {{ currentYear }}: {{ holidayStats.currentYearHolidays }}
            </span>
            <span>
              <lucide-icon name="trending-up" class="w-3 h-3 inline mr-1"></lucide-icon>
              {{ holidayStats.totalYears }} años
            </span>
          </div>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <!-- Botón para ajustar columnas -->
        <button 
          type="button"
          (click)="autoSizeColumns()"
          [disabled]="isLoading || !filteredRowData.length"
          class="inline-flex items-center gap-2 px-3 py-2 bg-fiori-info text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-fiori-info focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon name="columns" class="w-4 h-4"></lucide-icon>
          <span>Ajustar</span>
        </button>

        <!-- Botón exportar CSV -->
        <button 
          type="button"
          (click)="exportToCsv()"
          [disabled]="isLoading || !filteredRowData.length"
          class="inline-flex items-center gap-2 px-3 py-2 bg-fiori-success text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-fiori-success focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon name="download" class="w-4 h-4"></lucide-icon>
          <span>CSV</span>
        </button>

        <!-- Botón exportar Excel -->
        <button 
          type="button"
          (click)="exportToExcel()"
          [disabled]="isLoading || !filteredRowData.length"
          class="inline-flex items-center gap-2 px-3 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon name="file-spreadsheet" class="w-4 h-4"></lucide-icon>
          <span>Excel</span>
        </button>

        <!-- Botón exportar PDF -->
        <button 
          type="button"
          (click)="exportToPdf()"
          [disabled]="isLoading || !filteredRowData.length"
          class="inline-flex items-center gap-2 px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon name="file-text" class="w-4 h-4"></lucide-icon>
          <span>PDF</span>
        </button>
        
        <!-- Botón de sincronización -->
        <button 
          type="button"
          (click)="synchronizeData()"
          [disabled]="isSynchronizing"
          class="inline-flex items-center gap-2 px-4 py-2 bg-fiori-warning text-white text-sm font-medium rounded-lg hover:bg-orange-600 focus:ring-2 focus:ring-fiori-warning focus:ring-offset-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <lucide-icon [name]="isSynchronizing ? 'refresh-cw' : 'refresh-ccw'" 
                       [class]="isSynchronizing ? 'w-4 h-4 animate-spin' : 'w-4 h-4'"></lucide-icon>
          <span>{{ isSynchronizing ? 'Sincronizando...' : 'Sincronizar' }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Filtros con Flowbite -->
<div class="p-4 bg-gray-50" [formGroup]="filterForm">
    <div class="flex justify-end items-center">
        <div>
            <button id="dropdownFiltersButton" data-dropdown-toggle="dropdownFilters" class="text-white bg-fiori-primary hover:bg-fiori-secondary focus:ring-4 focus:outline-none focus:ring-fiori-primary font-medium rounded-lg text-sm px-4 py-2.5 text-center inline-flex items-center" type="button">
                <svg class="w-4 h-4 mr-2" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 10a1 1 0 011-1h6a1 1 0 011 1v2a1 1 0 01-1 1h-6a1 1 0 01-1-1v-2z"></path></svg>
                Filtros
                <svg class="w-4 h-4 ml-2" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
            <!-- Dropdown menu -->
            <div id="dropdownFilters" class="z-10 hidden w-80 p-3 bg-white rounded-lg shadow">
                <h6 class="mb-3 text-sm font-medium text-gray-900">Filtros</h6>
                <div class="space-y-4">
                    <div>
                        <label for="yearFilter" class="block mb-2 text-sm font-medium text-gray-900">Año</label>
                        <select id="yearFilter" formControlName="yearFilter" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <option value="all">Todos los años</option>
                            <option *ngFor="let year of availableYears" [value]="year">
                                {{ year }}{{ year == currentYear.toString() ? ' (Actual)' : '' }}
                            </option>
                        </select>
                    </div>
                    <div>
                        <label for="searchTerm" class="block mb-2 text-sm font-medium text-gray-900">Descripción</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-500" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>
                            </div>
                            <input type="text" id="searchTerm" formControlName="searchTerm" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full pl-10 p-2.5" placeholder="Buscar feriados...">
                        </div>
                    </div>
                    <div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" formControlName="showCurrentYearOnly" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-primary-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"></div>
                            <span class="ml-3 text-sm font-medium text-gray-900">Solo {{ currentYear }}</span>
                        </label>
                    </div>
                    <div class="flex justify-end">
                        <button type="button" (click)="onClearFilters()" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-primary-300 rounded-lg border border-gray-200 text-sm font-medium px-4 py-2 hover:text-gray-900 focus:z-10">Limpiar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Mensajes de estado -->
<div *ngIf="errorMessage && !isLoading" class="bg-fiori-error/10 border border-fiori-error/20 text-fiori-error px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="alert-circle" class="w-5 h-5"></lucide-icon>
  <span>{{ errorMessage }}</span>
</div>

<div *ngIf="successMessage && !isLoading && !isSynchronizing" class="bg-fiori-success/10 border border-fiori-success/20 text-fiori-success px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="check-circle" class="w-5 h-5"></lucide-icon>
  <span>{{ successMessage }}</span>
</div>

<!-- Loading indicator -->
<div *ngIf="isLoading" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border p-8 mb-4">
  <div class="flex flex-col items-center justify-center">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-fiori-primary mb-4"></div>
    <p class="text-fiori-subtext">Cargando feriados...</p>
  </div>
</div>

<!-- Indicador de sincronización -->
<div *ngIf="isSynchronizing" class="bg-fiori-warning/10 border border-fiori-warning/20 text-fiori-warning px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
  <lucide-icon name="refresh-cw" class="w-5 h-5 animate-spin"></lucide-icon>
  <span>Sincronizando datos desde API externa...</span>
</div>

<!-- AG-Grid Tabla -->
<div *ngIf="!isLoading && filteredRowData.length > 0" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border overflow-hidden">
  
  <!-- Header de la tabla -->
  <div class="px-4 py-3 border-b border-fiori-border bg-fiori-muted">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-fiori-text">
        Lista de Feriados
        <span class="text-sm font-normal text-fiori-subtext ml-2">
          ({{ filteredRowData.length }} registro{{ filteredRowData.length !== 1 ? 's' : '' }})
        </span>
      </h3>
      <div class="text-sm text-fiori-subtext">
        Última actualización: {{ currentDate | date:'dd/MM/yyyy HH:mm:ss' }}
      </div>
    </div>
  </div>

  <!-- AG-Grid Container sin paginación -->
  <div class="ag-theme-alpine" style="height: 600px; width: 100%;">
    <ag-grid-angular
      #agGrid
      [columnDefs]="columnDefs"
      [rowData]="paginatedData"
      [gridOptions]="gridOptions"
      style="height: 100%; width: 100%;">
    </ag-grid-angular>
  </div>

  <!-- Footer con estadísticas -->
  <div class="border-t border-fiori-border bg-fiori-muted/30 px-4 py-3" 
       *ngIf="holidayStats.totalHolidays">
    <div class="flex items-center justify-between text-sm">
      <div class="flex items-center gap-6">
        <span class="text-fiori-text">
          <strong>Total feriados:</strong> {{ holidayStats.totalHolidays }}
        </span>
        <span class="text-fiori-info">
          <strong>Año actual ({{ currentYear }}):</strong> {{ holidayStats.currentYearHolidays }}
        </span>
        <span class="text-fiori-warning">
          <strong>Años disponibles:</strong> {{ holidayStats.totalYears }}
        </span>
        <span class="text-fiori-success">
          <strong>Promedio por año:</strong> {{ holidayStats.averagePerYear }}
        </span>
      </div>
      <div class="text-fiori-subtext">
        Mostrando: {{ paginatedData.length }} de {{ filteredRowData.length }} filtrados ({{ holidayStats.totalHolidays }} total)
      </div>
    </div>
  </div>
</div>
  <!-- Paginador Fiori -->
  <app-fiori-paginator
    [totalRecords]="filteredRowData.length"
    [pageSize]="pageSize"
    [pageNumber]="pageNumber"
    [pageSizeOptions]="[10, 25, 50, 100]"
    [showAllOption]="true"
    [loading]="isLoading"
    (pageChange)="onPageChange($event)">
  </app-fiori-paginator>

<!-- Estado vacío -->
<div *ngIf="!isLoading && filteredRowData.length === 0 && rowData.length > 0" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border p-12 text-center">
  <div class="flex flex-col items-center">
    <div class="w-20 h-20 bg-fiori-muted rounded-full flex items-center justify-center mb-4">
      <lucide-icon name="search-x" class="w-10 h-10 text-fiori-subtext"></lucide-icon>
    </div>
    <h3 class="text-lg font-medium text-fiori-text mb-2">No se encontraron feriados</h3>
    <p class="text-sm text-fiori-subtext mb-6">
      Ajusta los filtros para ver más resultados
    </p>
    <button 
      type="button"
      (click)="onClearFilters()"
      class="inline-flex items-center gap-2 px-6 py-3 bg-fiori-primary text-white text-sm font-medium rounded-lg hover:bg-fiori-secondary transition-colors">
      <lucide-icon name="refresh-cw" class="w-4 h-4"></lucide-icon>
      Limpiar Filtros
    </button>
  </div>
</div>

<!-- Estado completamente vacío -->
<div *ngIf="!isLoading && rowData.length === 0" class="bg-fiori-surface rounded-lg shadow-fioriSm border border-fiori-border p-12 text-center">
  <div class="flex flex-col items-center">
    <div class="w-20 h-20 bg-fiori-muted rounded-full flex items-center justify-center mb-4">
      <lucide-icon name="calendar-x" class="w-10 h-10 text-fiori-subtext"></lucide-icon>
    </div>
    <h3 class="text-lg font-medium text-fiori-text mb-2">No hay feriados disponibles</h3>
    <p class="text-sm text-fiori-subtext mb-6">
      Sincroniza los datos para cargar los feriados desde la API externa
    </p>
    <button 
      type="button"
      (click)="synchronizeData()"
      [disabled]="isSynchronizing"
      class="inline-flex items-center gap-2 px-6 py-3 bg-fiori-warning text-white text-sm font-medium rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50">
      <lucide-icon [name]="isSynchronizing ? 'refresh-cw' : 'refresh-ccw'" 
                   [class]="isSynchronizing ? 'w-4 h-4 animate-spin' : 'w-4 h-4'"></lucide-icon>
      {{ isSynchronizing ? 'Sincronizando...' : 'Sincronizar Datos' }}
    </button>
  </div>
</div>