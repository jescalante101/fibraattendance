<div class="w-full max-w-6xl mx-auto">
  <div class="bg-white shadow rounded mb-6">

    <div class="p-4">
      <form [formGroup]="horarioForm" (ngSubmit)="guardarTurno()" class="space-y-6">
        <div>
          <label for="nombreHorario" class="block text-sm font-medium text-gray-700">Nombre del Horario</label>
          <input
            type="text"
            id="nombreHorario"
            formControlName="nombre"
            placeholder="Ingrese el nombre del horario"
            class="mt-1 block w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"
            [ngClass]="{'border-red-500': horarioForm.get('nombre')?.invalid && (horarioForm.get('nombre')?.touched || horarioForm.get('nombre')?.dirty)}"
          />
          <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('nombre')?.errors && (horarioForm.get('nombre')?.touched || horarioForm.get('nombre')?.dirty)">
            <span *ngIf="horarioForm.get('nombre')?.errors?.['required']">El nombre es obligatorio.</span>
            <span *ngIf="horarioForm.get('nombre')?.errors?.['maxlength']">Máximo 50 caracteres.</span>
          </div>
        </div>

        <mat-tab-group>

          <mat-tab label="Configuración básica">
            <div class="space-y-4 mt-4 mb-4 border-b pb-4 border-gray-200 block items-center">
              <label for="totalMarcaciones" class="text-sm font-medium p-2">Total de marcaciones requeridas</label>
              <input 
                type="number" 
                id="totalMarcaciones" 
                formControlName="totalMarcaciones" 
                class="border px-3 py-2 rounded text-sm w-1/2" 
                [ngClass]="{'border-red-500': horarioForm.get('totalMarcaciones')?.invalid && (horarioForm.get('totalMarcaciones')?.touched || horarioForm.get('totalMarcaciones')?.dirty)}"
              />
              <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('totalMarcaciones')?.errors && (horarioForm.get('totalMarcaciones')?.touched || horarioForm.get('totalMarcaciones')?.dirty)">
                <span *ngIf="horarioForm.get('totalMarcaciones')?.errors?.['min']">El valor mínimo debe ser 1.</span>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
              <div class="bg-gray-50 border rounded shadow-sm p-4">
                <span class="font-semibold text-sm mb-3">Horario de entrada</span>
                
                <div class="space-y-4">
                  <div>
                    <label for="horaEntrada" class="block text-sm font-medium">Hora de entrada</label>
                    <input type="time" id="horaEntrada" formControlName="horaEntrada" class="w-full border px-3 py-2 rounded text-sm focus:outline-none focus:ring" />
                  </div>
                  <div *ngIf="useMode == 0">
                    <label for="permitirMarcarDesde" class="block text-sm font-medium">Permitir marcar desde</label>
                    <input type="time" id="permitirMarcarDesde" formControlName="horaEntradaDesde" class="w-full border px-3 py-2 rounded text-sm" />
                  </div>
                  <div *ngIf="useMode == 0">
                    <label for="toleranciaEntrada" class="block text-sm font-medium">Tolerancia</label>
                    <input type="time" id="toleranciaEntrada" formControlName="horaEntradaHasta" class="w-full border px-3 py-2 rounded text-sm" />
                  </div>
                  <div>
                    <span class="font-semibold text-sm mb-3">Días Laborales</span>
                    <div>
                      <select name="diasLaborales" id="diasLaborales" formControlName="diasLaboral">
                        <!-- if useMode == 0 show Horas -->
                        
                        <option value="0">Horas</option>
                        <option value="0.5">Medio día</option>
                        <option value="1">Completo</option>
                        
                      </select>
                    </div>
                    
                  </div>
                </div>
              </div>
              <div class="bg-gray-50 border rounded shadow-sm p-4">
                <span class="font-semibold text-sm mb-3 text-tiltle">Horario de salida</span>
                <div class="space-y-4">
                  <div>
                    <label for="horaSalida" class="block text-sm font-medium">Hora de salida</label>
                    <input type="time" id="horaSalida" formControlName="horaSalida" class="w-full border px-3 py-2 rounded text-sm" />
                  </div>
                  <div *ngIf="useMode == 0">
                    <label for="permitirMarcarHasta" class="block text-sm font-medium">Permitir marcar desde</label>
                    <input type="time" id="permitirMarcarHasta" formControlName="horaSalidaDesde" class="w-full border px-3 py-2 rounded text-sm" />
                  </div>
                  <div *ngIf="useMode == 0">
                    <label for="toleranciaSalida" class="block text-sm font-medium">Tolerancia</label>
                    <input type="time" id="toleranciaSalida" formControlName="horaSalidaHasta" class="w-full border px-3 py-2 rounded text-sm" />
                  </div>
                </div>
              </div>
            </div>
          </mat-tab>

          <mat-tab *ngIf="useMode==0" label="Cónfiguración de descanso">
            <div class="overflow-x-auto mt-4">
              <table class="min-w-full text-sm border rounded">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-2 py-1 border">Seleccionar</th>
                    <th class="px-2 py-1 border">Nombre</th>
                    <th class="px-2 py-1 border">Hora inicio</th>
                    <th class="px-2 py-1 border">Hora fin</th>
                    <th class="px-2 py-1 border">Duración</th>
                    <th class="px-2 py-1 border">Tipo</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of descansoData" class="hover:bg-gray-50">
                    <td class="px-2 py-1 border text-center">
                      <input type="radio" name="descansoSelect" [value]="item.id" formControlName="breakTimeId" />
                    </td>
                    <td class="px-2 py-1 border">{{item.alias}}</td>
                    <td class="px-2 py-1 border">{{item.periodStart | date: 'HH:mm:ss'}}</td>
                    <td class="px-2 py-1 border">{{item.periodEnd | date: 'HH:mm:ss'}}</td>
                    <td class="px-2 py-1 border">{{item.duration}}</td>
                    <td class="px-2 py-1 border">
                      <ng-container *ngIf="item.calcType == 0; else manualTemplate">Auto Deducir</ng-container>
                      <ng-template #manualTemplate>Manual</ng-template>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="mt-4">
                <mat-paginator
                  [length]="totalRecords"
                  [pageSize]="pageSize"
                  [pageIndex]="pageNumber - 1"
                  (page)="handlePageEvent($event)"
                  [pageSizeOptions]="[5, 10, 20, 50]"
                  showFirstLastButtons
                  aria-label="Seleccione la página">
                </mat-paginator>
              </div>
            </div>
          </mat-tab>
          <mat-tab *ngIf="useMode==0" label="Tiempo no programado">
            <div class="p-4 grid md:grid-cols-2 gap-4">
              <div *ngIf="useMode==0">
                <label for="entradaTemprana" class="block text-sm font-medium mb-1">Entrada temprana</label>
                <mat-form-field appearance="outline" class="w-full">
                  <mat-select id="entradaTemprana" formControlName="entradaTemprana">
                    <mat-option [value]="0">Ignorar</mat-option>
                    <mat-option [value]="1">Mover al Trabajo normal</mat-option>
                    <mat-option [value]="2">Mover al H.E Normal</mat-option>
                    <mat-option [value]="3">Mover al F.Semana H.E</mat-option>
                    <mat-option [value]="4">Mover al H.E Vacaciones</mat-option>
                  </mat-select>
                </mat-form-field>
                
              </div>
              <div>
                <label for="salidaTarde" class="block text-sm font-medium mb-1">Salida tarde</label>
                <mat-form-field appearance="outline" class="w-full">
                  <mat-select id="salidaTarde" formControlName="entradaTarde">
                    <mat-option [value]="0">Ignorar</mat-option>
                    <mat-option [value]="1">Mover al Trabajo normal</mat-option>
                    <mat-option [value]="2">Mover al H.E Normal</mat-option>
                    <mat-option [value]="3">Mover al F.Semana H.E</mat-option>
                    <mat-option [value]="4">Mover al H.E Vacaciones</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div *ngIf="useMode==0">
                <label for="minimoEntrada" class="block text-sm font-medium mb-1">Mínimo Entrada temprana</label>
                <mat-form-field appearance="outline" class="w-full" disabled="false">
                  <input matInput type="number" id="minimoEntrada" formControlName="minEntradaTemprana" min="0" [readonly]="horarioForm.get('entradaTemprana')?.value == 0" />
                  <span matSuffix>Minuto(s)</span>
                </mat-form-field>
                <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('minEntradaTemprana')?.errors && (horarioForm.get('minEntradaTemprana')?.touched || horarioForm.get('minEntradaTemprana')?.dirty)">
                  <span *ngIf="horarioForm.get('minEntradaTemprana')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                </div>
              </div>
              <div>
                <label for="minimoSalida" class="block text-sm font-medium mb-1">Mínimo Salida tarde</label>
                <mat-form-field appearance="outline" class="w-full">
                  <input matInput type="number" id="minimoSalida" formControlName="minSalidaTarde" [readonly]="horarioForm.get('entradaTarde')?.value == 0" min="0" />
                  <span matSuffix>Minuto(s)</span>
                </mat-form-field>
                <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('minSalidaTarde')?.errors && (horarioForm.get('minSalidaTarde')?.touched || horarioForm.get('minSalidaTarde')?.dirty)">
                  <span *ngIf="horarioForm.get('minSalidaTarde')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                </div>
              </div>
            </div>
          </mat-tab>

         <mat-tab label="Ajuste de nivel de H.E">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
              <div class="bg-gray-50 border rounded shadow-sm p-4">
                <span class="font-semibold text-sm mb-3">Configuración nivel 1</span>
                <div class="space-y-4">
                  <div>
                    <label for="heNivel" class="block text-sm font-medium">H.E. Nivel</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <mat-select id="heNivel" formControlName="hNivel">
                        <mat-option [value]="0">Ignorar</mat-option>
                        <mat-option [value]="1">Depende del T.Trabajo</mat-option>
                        <mat-option [value]="2">Depende del H.E</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div>
                    <label for="heNivel2" class="block text-sm font-medium">H.E. Nivel 2</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <input matInput type="number" id="heNivel2" formControlName="hNivel1" [readonly]="horarioForm.get('hNivel')?.value == 0" />
                      <span matSuffix>minutos</span>
                    </mat-form-field>
                    <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('hNivel1')?.errors && (horarioForm.get('hNivel1')?.touched || horarioForm.get('hNivel1')?.dirty)">
                      <span *ngIf="horarioForm.get('hNivel1')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-gray-50 border rounded shadow-sm p-4">
                <span class="font-semibold text-sm mb-3">Configuración nivel 2</span>
                <div class="space-y-4">
                  <div>
                    <label for="heNivel1" class="block text-sm font-medium">H.E. Nivel 1</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <input matInput type="number" id="heNivel1" formControlName="hNivel2" [readonly]="horarioForm.get('hNivel')?.value == 0" />
                      <span matSuffix>minutos</span>
                    </mat-form-field>
                    <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('hNivel2')?.errors && (horarioForm.get('hNivel2')?.touched || horarioForm.get('hNivel2')?.dirty)">
                      <span *ngIf="horarioForm.get('hNivel2')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                    </div>
                  </div>
                  <div>
                    <label for="heNivel3" class="block text-sm font-medium">H.E. Nivel 3</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <input matInput type="number" id="heNivel3" formControlName="hNivel3" [readonly]="horarioForm.get('hNivel')?.value == 0" />
                      <span matSuffix>minutos</span>
                    </mat-form-field>
                    <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('hNivel3')?.errors && (horarioForm.get('hNivel3')?.touched || horarioForm.get('hNivel3')?.dirty)">
                      <span *ngIf="horarioForm.get('hNivel3')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </mat-tab>

          <mat-tab label="Configuración reglas">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
              <div class="bg-gray-50 border rounded shadow-sm p-4">
                <span class="font-semibold text-sm mb-3">Configuración de entrada</span>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium">Necesario marcar entrada</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <mat-select formControlName="marcarEntrada">
                        <mat-option [value]="true">Sí</mat-option>
                        <mat-option [value]="false">No</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Permitir llegada tarde</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <input matInput type="number" formControlName="permiteLLegarT" min="0" />
                      <span matSuffix>minutos</span>
                    </mat-form-field>
                    <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('permiteLLegarT')?.errors && (horarioForm.get('permiteLLegarT')?.touched || horarioForm.get('permiteLLegarT')?.dirty)">
                      <span *ngIf="horarioForm.get('permiteLLegarT')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Tipo de intervalo marcación</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <mat-select formControlName="tipoIntervalo">
                        <mat-option [value]="0">Acorde a la regla</mat-option>
                        <mat-option [value]="1">Usuario Definido</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Basado en Marcación</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <mat-select formControlName="basadoM">
                        <mat-option [value]="0">NO</mat-option>
                        <mat-option [value]="1">SI</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div class="bg-gray-50 border rounded shadow-sm p-4">
                <span class="font-semibold text-sm mb-3">Configuración de salida</span>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium">Necesario marcar salida</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <mat-select formControlName="marcarSalida">
                        <mat-option [value]="true">Sí</mat-option>
                        <mat-option [value]="false">No</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Permitir salida temprana</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <input matInput type="number" formControlName="permiteSalidaT" min="0" />
                      <span matSuffix>minutos</span>
                    </mat-form-field>
                    <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('permiteSalidaT')?.errors && (horarioForm.get('permiteSalidaT')?.touched || horarioForm.get('permiteSalidaT')?.dirty)">
                      <span *ngIf="horarioForm.get('permiteSalidaT')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Periodo de Marcación</label>
                    <mat-form-field appearance="outline" class="w-full">
                      <input matInput type="number" formControlName="periodoMarcacion" min="0" [disabled]="true" />
                      <span matSuffix>minutos</span>
                    </mat-form-field>
                    <div class="text-red-500 text-xs mt-1" *ngIf="horarioForm.get('periodoMarcacion')?.errors && (horarioForm.get('periodoMarcacion')?.touched || horarioForm.get('periodoMarcacion')?.dirty)">
                      <span *ngIf="horarioForm.get('periodoMarcacion')?.errors?.['min']">El valor mínimo debe ser 0.</span>
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Hora de cambio</label>
                    <input matInput type="time" formControlName="horaCambio" class="mt-1 block w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500" />
                  </div>
                </div>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>

        <div class="flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
         
          <button 
            type="submit" 
            [disabled]="horarioForm.invalid || loading"
            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <svg *ngIf="!loading" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75z" />
            </svg>
            <div *ngIf="loading" class="w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            {{ isEditMode ? 'Actualizar' : 'Guardar' }}
          </button>
           <button 
            type="button" 
            (click)="cancelar()"
            class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
            Cancelar
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
