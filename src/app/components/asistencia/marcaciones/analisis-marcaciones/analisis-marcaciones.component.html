<div class="p-4 max-w-full h-screen flex flex-col">
  <!-- Header compacto -->
  <div class="mb-4 flex items-center justify-between bg-white p-3 rounded-lg shadow-sm border">
    <div class="flex items-center gap-2">
      <div class="w-1 h-6 bg-blue-600 rounded-full"></div>
      <span class="text-gray-900 font-semibold text-lg">Análisis de Marcaciones</span>
      <div class="ml-4 flex items-center gap-1 text-sm text-gray-500">
        <mat-icon class="text-base">dataset</mat-icon>
        <span>{{ totalCount }}</span> registros
      </div>
    </div>
    <div class="flex gap-2">
      <!-- Download excel -->
      <button 
        (click)="downloadExcel()" 
        class="inline-flex items-center gap-1 px-3 py-1.5 text-sm bg-green-50 text-green-700 border border-green-200 rounded-md hover:bg-green-100 transition-colors">
        <mat-icon class="text-sm">download</mat-icon>
        Descargar
      </button>

      <!-- Excel -->
      <button 
        (click)="exportToExcel()" 
        class="inline-flex items-center gap-1 px-3 py-1.5 text-sm bg-green-50 text-green-700 border border-green-200 rounded-md hover:bg-green-100 transition-colors">
        <mat-icon class="text-sm">download</mat-icon>
        Excel
      </button>
      <!-- PDF -->
      <button 
        (click)="exportToPDF()" 
        class="inline-flex items-center gap-1 px-3 py-1.5 text-sm bg-red-50 text-red-700 border border-red-200 rounded-md hover:bg-red-100 transition-colors">
        <mat-icon class="text-sm">picture_as_pdf</mat-icon>
        PDF
      </button>
    </div>
  </div>

  <!-- Filtros compactos en tarjeta -->
  <div class="mb-4 bg-white rounded-lg shadow-sm border">
    <!-- Quick filters -->
    <div class="px-4 pt-3 pb-2 border-b border-gray-100">
      <div class="flex flex-wrap gap-2">
        <button 
          (click)="applyQuickFilter('today')"
          [class]="getQuickFilterClass('today')"
          class="px-3 py-1 text-xs border rounded-md transition-colors">
          Hoy
        </button>
        <button 
          (click)="applyQuickFilter('week')"
          [class]="getQuickFilterClass('week')"
          class="px-3 py-1 text-xs border rounded-md transition-colors">
          Esta semana
        </button>
        <button 
          (click)="applyQuickFilter('month')"
          [class]="getQuickFilterClass('month')"
          class="px-3 py-1 text-xs border rounded-md transition-colors">
          Este mes
        </button>
        <div class="ml-auto flex items-center gap-2">
          <button 
            (click)="showFilters = !showFilters"
            class="inline-flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-blue-600 transition-colors">
            <mat-icon class="text-sm">tune</mat-icon>
            Filtros
          </button>
        </div>
      </div>
    </div>

    <!-- Filtros expandibles -->
    <div *ngIf="showFilters" class="p-4 fade-in">
      <form [formGroup]="filterForm" (ngSubmit)="onFilter()">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Fecha Inicio</label>
            <input 
              type="date" 
              formControlName="fechaInicio"
              class="w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Fecha Fin</label>
            <input 
              type="date" 
              formControlName="fechaFin"
              class="w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Buscar</label>
            <div class="relative">
              <input 
                type="text" 
                formControlName="filter"
                placeholder="Nombre, documento..." 
                class="w-full pl-7 pr-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
              <mat-icon class="absolute left-2 top-1.5 text-gray-400 text-sm">search</mat-icon>
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Área</label>
            <select 
              formControlName="areaId"
              class="w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white">
              <option value="">Todas las áreas</option>
              <option *ngFor="let area of areas" [value]="area.areaId">{{ area.descripcion }}</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Sede</label>
            <select 
              formControlName="locationId"
              class="w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white">
              <option value="">Todas las sedes</option>
              <option *ngFor="let sede of sedes" [value]="sede.categoriaAuxiliarId">{{ sede.descripcion }}</option>
            </select>
          </div>
        </div>
        <div class="mt-3 flex gap-2">
          <button 
            type="submit"
            class="inline-flex items-center gap-1 px-3 py-1.5 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
            <mat-icon class="text-sm">filter_list</mat-icon>
            Aplicar
          </button>
          <button 
            type="button"
            (click)="filterForm.reset(); onFilter();"
            class="inline-flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
            <mat-icon class="text-sm">refresh</mat-icon>
            Limpiar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabla compacta con scroll horizontal -->
  <div class="flex-1 bg-white rounded-lg shadow-sm border overflow-hidden flex flex-col">
    
    <!-- Header con configuración de columnas -->
    <div class="bg-gray-50 border-b border-gray-200 px-4 py-2 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="text-sm font-semibold text-gray-900">Registros de Asistencia Agrupados</div>
        <div class="text-xs text-gray-500">{{ totalCount }} registros</div>
      </div>
      <div class="flex items-center gap-2">
        <button 
          (click)="showColumnsConfig = !showColumnsConfig"
          class="inline-flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-blue-600 transition-colors">
          <mat-icon class="text-sm">view_column</mat-icon>
          Columnas
        </button>
      </div>
    </div>

    <!-- Configuración de columnas -->
    <div *ngIf="showColumnsConfig" class="border-b border-gray-200 p-3 bg-gray-50">
      <div class="flex flex-wrap gap-2 mb-2">
        <button 
          (click)="showAllColumns()"
          class="px-2 py-1 text-xs bg-blue-50 text-blue-700 border border-blue-200 rounded hover:bg-blue-100">
          Mostrar Todas
        </button>
        <button 
          (click)="hideAllColumns()"
          class="px-2 py-1 text-xs bg-gray-50 text-gray-700 border border-gray-200 rounded hover:bg-gray-100">
          Ocultar Todas
        </button>
      </div>
      <div class="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-8 gap-1">
        <label *ngFor="let col of columns" class="flex items-center gap-1 text-xs">
          <input 
            type="checkbox" 
            [(ngModel)]="col.visible"
            class="w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
          <span class="truncate">{{ col.label }}</span>
        </label>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading" class="flex-1 flex items-center justify-center">
      <div class="flex items-center gap-2">
        <mat-spinner diameter="20"></mat-spinner>
        <span class="text-gray-500 text-sm">Cargando datos...</span>
      </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="!loading && groupedDataSource.data.length === 0" class="flex-1 flex items-center justify-center">
      <div class="flex flex-col items-center gap-2">
        <mat-icon class="text-gray-300 text-4xl">description</mat-icon>
        <span class="text-gray-500 text-sm">No hay datos para mostrar</span>
        <button 
          (click)="filterForm.reset(); getData();"
          class="text-xs text-blue-600 hover:text-blue-800 mt-2">
          Limpiar filtros
        </button>
      </div>
    </div>

    <!-- Tabla con scroll horizontal y vertical -->
    <div *ngIf="!loading && groupedDataSource.data.length > 0" class="flex-1 overflow-auto">
      <table class="w-full text-xs divide-y divide-gray-200" style="min-width: 2000px;">
        <!-- Header sticky -->
        <thead class="bg-gray-50 sticky top-0 z-10">
          <tr>
            <!-- Empleado -->
            <th *ngIf="isColumnVisible('fullNameEmployee')" 
                class="px-2 py-2 text-left font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200 sticky left-0 bg-gray-50 z-20" 
                style="min-width: 180px;">
              <div class="flex items-center gap-1">
                <span>Empleado</span>
                <button (click)="onSort('fullNameEmployee')" class="ml-1">
                  <mat-icon class="text-xs">{{ getSortIcon('fullNameEmployee') }}</mat-icon>
                </button>
              </div>
            </th>

            <!-- Documento -->
            <th *ngIf="isColumnVisible('nroDoc')" 
                class="px-2 py-2 text-left font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 100px;">
              <div class="flex items-center gap-1">
                <span>Doc</span>
                <button (click)="onSort('nroDoc')" class="ml-1">
                  <mat-icon class="text-xs">{{ getSortIcon('nroDoc') }}</mat-icon>
                </button>
              </div>
            </th>

            <!-- Área -->
            <th *ngIf="isColumnVisible('areaDescription')" 
                class="px-2 py-2 text-left font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 120px;">
              <div class="flex items-center gap-1">
                <span>Área</span>
                <button (click)="onSort('areaDescription')" class="ml-1">
                  <mat-icon class="text-xs">{{ getSortIcon('areaDescription') }}</mat-icon>
                </button>
              </div>
            </th>

            <!-- Sede -->
            <th *ngIf="isColumnVisible('locationName')" 
                class="px-2 py-2 text-left font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 120px;">
              <div class="flex items-center gap-1">
                <span>Sede</span>
                <button (click)="onSort('locationName')" class="ml-1">
                  <mat-icon class="text-xs">{{ getSortIcon('locationName') }}</mat-icon>
                </button>
              </div>
            </th>

            <!-- Fecha -->
            <th *ngIf="isColumnVisible('fechaFormateada')" 
                class="px-2 py-2 text-left font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 90px;">
              <div class="flex items-center gap-1">
                <span>Fecha</span>
                <button (click)="onSort('fechaFormateada')" class="ml-1">
                  <mat-icon class="text-xs">{{ getSortIcon('fechaFormateada') }}</mat-icon>
                </button>
              </div>
            </th>

            <!-- Turno -->
            <th *ngIf="isColumnVisible('shiftName')" 
                class="px-2 py-2 text-left font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 120px;">
              <div class="flex items-center gap-1">
                <span>Turno</span>
                <button (click)="onSort('shiftName')" class="ml-1">
                  <mat-icon class="text-xs">{{ getSortIcon('shiftName') }}</mat-icon>
                </button>
              </div>
            </th>

            <!-- Entrada - Horario -->
            <th *ngIf="isColumnVisible('intervalAlias')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 100px;">
              Entrada Horario
            </th>

            <!-- Entrada - Esperado -->
            <th *ngIf="isColumnVisible('horaEsperada')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 80px;">
              Entrada Esperado
            </th>

            <!-- Entrada - Real -->
            <th *ngIf="isColumnVisible('horaMarcacionReal')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 80px;">
              Entrada Real
            </th>

            <!-- Entrada - Estado -->
            <th *ngIf="isColumnVisible('estadoMarcacion')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 90px;">
              Entrada Estado
            </th>

            <!-- Entrada - Tardanza -->
            <th *ngIf="isColumnVisible('minutosTardanza')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 80px;">
              Tardanza (min)
            </th>

            <!-- Salida - Horario -->
            <th *ngIf="isColumnVisible('intervalAlias')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 100px;">
              Salida Horario
            </th>

            <!-- Salida - Esperado -->
            <th *ngIf="isColumnVisible('horaEsperada')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 80px;">
              Salida Esperado
            </th>

            <!-- Salida - Real -->
            <th *ngIf="isColumnVisible('horaMarcacionReal')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 80px;">
              Salida Real
            </th>

            <!-- Salida - Estado -->
            <th *ngIf="isColumnVisible('estadoMarcacion')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 90px;">
              Salida Estado
            </th>

            <!-- Salida - Adelanto -->
            <th *ngIf="isColumnVisible('minutosAdelanto')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 80px;">
              Adelanto (min)
            </th>

            <!-- Tipo Horario -->
            <th *ngIf="isColumnVisible('tipoMarcacion')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 100px;">
              Tipo Horario
            </th>

            <!-- Observaciones -->
            <th *ngIf="isColumnVisible('exceptionRemarks')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 150px;">
              Observaciones
            </th>

            <!-- Tipo Permiso -->
            <th *ngIf="isColumnVisible('tipoPermiso')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 120px;">
              Tipo Permiso
            </th>

            <!-- Días Info -->
            <th *ngIf="isColumnVisible('diasInfo')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 100px;">
              Días Info
            </th>

            <!-- Razón Manual -->
            <th *ngIf="isColumnVisible('razonManual')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 120px;">
              Razón Manual
            </th>

            <!-- Validación Rango -->
            <th *ngIf="isColumnVisible('validacionRango')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 120px;">
              Validación
            </th>

            <!-- Información Adicional -->
            <th *ngIf="isColumnVisible('informacionAdicional')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 150px;">
              Info Adicional
            </th>

            <!-- Origen -->
            <th *ngIf="isColumnVisible('origenMarcacion')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200" 
                style="min-width: 100px;">
              Origen
            </th>

            <!-- Acciones -->
            <th *ngIf="isColumnVisible('actions')" 
                class="px-2 py-2 text-center font-medium text-gray-500 uppercase tracking-wider" 
                style="min-width: 80px;">
              Acciones
            </th>
          </tr>
        </thead>
        
        <!-- Body -->
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let record of groupedDataSource.data; trackBy: trackByGroupedRecord" 
              [class]="getGroupedRowClass(record) + ' transition-colors'">
            
            <!-- Empleado -->
            <td *ngIf="isColumnVisible('fullNameEmployee')" 
                [class]="'px-2 py-1 border-r border-gray-200 sticky left-0 z-10 ' + getGroupedRowClass(record)">
              <div class="text-xs font-medium text-gray-900 truncate">{{ record.fullNameEmployee }}</div>
            </td>

            <!-- Documento -->
            <td *ngIf="isColumnVisible('nroDoc')" class="px-2 py-1 border-r border-gray-200">
              <div class="text-xs text-gray-900">{{ record.nroDoc }}</div>
            </td>

            <!-- Área -->
            <td *ngIf="isColumnVisible('areaDescription')" class="px-2 py-1 border-r border-gray-200">
              <div class="text-xs text-gray-900 truncate">{{ record.areaDescription }}</div>
            </td>

            <!-- Sede -->
            <td *ngIf="isColumnVisible('locationName')" class="px-2 py-1 border-r border-gray-200">
              <div class="text-xs text-gray-900 truncate">{{ record.locationName }}</div>
            </td>

            <!-- Fecha -->
            <td *ngIf="isColumnVisible('fechaFormateada')" class="px-2 py-1 border-r border-gray-200">
              <div class="text-xs text-gray-900">{{ record.fechaFormateada }}</div>
            </td>

            <!-- Turno -->
            <td *ngIf="isColumnVisible('shiftName')" class="px-2 py-1 border-r border-gray-200">
              <div class="text-xs text-gray-900 truncate">{{ record.shiftName }}</div>
            </td>

            <!-- Entrada - Horario -->
            <td *ngIf="isColumnVisible('intervalAlias')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">
                {{ record.marcaciones.entrada?.intervalAlias || '-' }}
              </div>
            </td>

            <!-- Entrada - Esperado -->
            <td *ngIf="isColumnVisible('horaEsperada')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">
                {{ record.marcaciones.entrada?.horaEsperada || '-' }}
              </div>
            </td>

            <!-- Entrada - Real -->
            <td *ngIf="isColumnVisible('horaMarcacionReal')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs font-medium text-gray-900">
                {{ record.marcaciones.entrada?.horaMarcacionReal || 'Sin marcar' }}
              </div>
            </td>

            <!-- Entrada - Estado -->
            <td *ngIf="isColumnVisible('estadoMarcacion')" class="px-2 py-1 text-center border-r border-gray-200">
              <span *ngIf="record.marcaciones.entrada" 
                    [class]="getEstadoBadgeClass(record.marcaciones.entrada.estadoMarcacion)"
                    class="inline-flex items-center px-1 py-0.5 rounded text-xs font-medium">
                {{ record.marcaciones.entrada.estadoMarcacion }}
              </span>
              <span *ngIf="!record.marcaciones.entrada" class="text-xs text-gray-400">-</span>
            </td>

            <!-- Entrada - Tardanza -->
            <td *ngIf="isColumnVisible('minutosTardanza')" class="px-2 py-1 text-center border-r border-gray-200">
              <div *ngIf="record.marcaciones.entrada && record.marcaciones.entrada.minutosTardanza > 0" 
                   class="text-xs text-red-600 font-medium">
                +{{ record.marcaciones.entrada.minutosTardanza }}
              </div>
              <div *ngIf="!record.marcaciones.entrada || record.marcaciones.entrada.minutosTardanza <= 0" 
                   class="text-xs text-gray-400">-</div>
            </td>

            <!-- Salida - Horario -->
            <td *ngIf="isColumnVisible('intervalAlias')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">
                {{ record.marcaciones.salida?.intervalAlias || '-' }}
              </div>
            </td>

            <!-- Salida - Esperado -->
            <td *ngIf="isColumnVisible('horaEsperada')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">
                {{ record.marcaciones.salida?.horaEsperada || '-' }}
              </div>
            </td>

            <!-- Salida - Real -->
            <td *ngIf="isColumnVisible('horaMarcacionReal')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs font-medium text-gray-900">
                {{ record.marcaciones.salida?.horaMarcacionReal || 'Sin marcar' }}
              </div>
            </td>

            <!-- Salida - Estado -->
            <td *ngIf="isColumnVisible('estadoMarcacion')" class="px-2 py-1 text-center border-r border-gray-200">
              <span *ngIf="record.marcaciones.salida" 
                    [class]="getEstadoBadgeClass(record.marcaciones.salida.estadoMarcacion)"
                    class="inline-flex items-center px-1 py-0.5 rounded text-xs font-medium">
                {{ record.marcaciones.salida.estadoMarcacion }}
              </span>
              <span *ngIf="!record.marcaciones.salida" class="text-xs text-gray-400">-</span>
            </td>

            <!-- Salida - Adelanto -->
            <td *ngIf="isColumnVisible('minutosAdelanto')" class="px-2 py-1 text-center border-r border-gray-200">
              <div *ngIf="record.marcaciones.salida && record.marcaciones.salida.minutosAdelanto > 0" 
                   class="text-xs text-green-600 font-medium">
                -{{ record.marcaciones.salida.minutosAdelanto }}
              </div>
              <div *ngIf="!record.marcaciones.salida || record.marcaciones.salida.minutosAdelanto <= 0" 
                   class="text-xs text-gray-400">-</div>
            </td>

            <!-- Tipo Horario -->
            <td *ngIf="isColumnVisible('tipoMarcacion')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">{{ record.tipoHorario || '-' }}</div>
            </td>

            <!-- Observaciones (exceptionRemarks) -->
            <td *ngIf="isColumnVisible('exceptionRemarks')" class="px-2 py-1 text-center border-r border-gray-200">
              <div *ngIf="record.exceptionRemarks" class="text-xs text-orange-700 bg-orange-100 px-2 py-1 rounded">
                {{ record.exceptionRemarks }}
              </div>
              <div *ngIf="!record.exceptionRemarks" class="text-xs text-gray-400">-</div>
            </td>

            <!-- Tipo Permiso -->
            <td *ngIf="isColumnVisible('tipoPermiso')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">{{ record.tipoPermiso || '-' }}</div>
            </td>

            <!-- Días Info -->
            <td *ngIf="isColumnVisible('diasInfo')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">{{ record.diasInfo || '-' }}</div>
            </td>

            <!-- Razón Manual -->
            <td *ngIf="isColumnVisible('razonManual')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">{{ record.razonManual || '-' }}</div>
            </td>

            <!-- Validación Rango -->
            <td *ngIf="isColumnVisible('validacionRango')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">{{ record.validacionRango || '-' }}</div>
            </td>

            <!-- Información Adicional -->
            <td *ngIf="isColumnVisible('informacionAdicional')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900 truncate">
                {{ (record.marcaciones.entrada?.informacionAdicional || record.marcaciones.salida?.informacionAdicional) || '-' }}
              </div>
            </td>

            <!-- Origen -->
            <td *ngIf="isColumnVisible('origenMarcacion')" class="px-2 py-1 text-center border-r border-gray-200">
              <div class="text-xs text-gray-900">
                {{ (record.marcaciones.entrada?.origenMarcacion || record.marcaciones.salida?.origenMarcacion) || '-' }}
              </div>
            </td>

            <!-- Acciones -->
            <td *ngIf="isColumnVisible('actions')" class="px-2 py-1 text-center">
              <div class="flex items-center justify-center gap-1">
                <button 
                  (click)="viewDetails(record)"
                  class="p-1 text-blue-600 hover:text-blue-800 transition-colors"
                  title="Ver detalles">
                  <mat-icon class="text-sm">visibility</mat-icon>
                </button>
                <button 
                  (click)="editItem(record)"
                  class="p-1 text-green-600 hover:text-green-800 transition-colors"
                  title="Editar">
                  <mat-icon class="text-sm">edit</mat-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Paginador compacto -->
  <div class="mt-4 flex flex-col sm:flex-row justify-between items-center gap-3 bg-white p-3 rounded-lg shadow-sm border">
    <div class="flex items-center gap-2 text-sm text-gray-600">
      <span>Mostrar</span>
      <select 
        [(ngModel)]="pageSize" 
        (change)="onPageSizeChange()" 
        class="px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <option [value]="10">10</option>
        <option [value]="20">20</option>
        <option [value]="50">50</option>
        <option [value]="100">100</option>
      </select>
      <span>de {{ totalCount | number }} resultados</span>
    </div>
    
    <div class="flex items-center gap-1">
      <span class="text-sm text-gray-600 mr-4">
        {{ getPageStart() }} - {{ getPageEnd() }} de {{ totalCount | number }}
      </span>
      
      <button 
        (click)="onPageChange(1)" 
        [disabled]="page === 1"
        class="p-1.5 rounded border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        title="Primera página">
        <mat-icon class="text-sm">first_page</mat-icon>
      </button>
      
      <button 
        (click)="onPageChange(page - 1)" 
        [disabled]="page === 1"
        class="p-1.5 rounded border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        title="Página anterior">
        <mat-icon class="text-sm">chevron_left</mat-icon>
      </button>
      
      <div class="flex gap-1">
        <button 
          *ngFor="let pageNum of getVisiblePages()"
          (click)="onPageChange(pageNum)"
          [class]="pageNum === page ? 'px-2 py-1.5 text-sm bg-blue-600 text-white rounded border border-blue-600' : 'px-2 py-1.5 text-sm border border-gray-300 hover:bg-gray-50 rounded transition-colors'"
          [disabled]="pageNum === '...'"
          class="min-w-[32px]">
          {{ pageNum }}
        </button>
      </div>
      
      <button 
        (click)="onPageChange(page + 1)" 
        [disabled]="page >= totalPages"
        class="p-1.5 rounded border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        title="Página siguiente">
        <mat-icon class="text-sm">chevron_right</mat-icon>
      </button>
      
      <button 
        (click)="onPageChange(totalPages)" 
        [disabled]="page >= totalPages"
        class="p-1.5 rounded border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        title="Última página">
        <mat-icon class="text-sm">last_page</mat-icon>
      </button>
    </div>
  </div>
</div>