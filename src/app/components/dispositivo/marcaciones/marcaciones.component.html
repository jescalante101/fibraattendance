<app-modal-loading *ngIf="isLoading"></app-modal-loading>

<div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
  {{ errorMessage }}
</div>

<div class="border-bottom container pt-2 mb-5">
  <h3 class=" mb-3 text-fiori-neutral font-semibold text-lg">Marcaciones</h3>

  <div class="btn-group btn-group-sm border mb-2" role="group" aria-label="Acciones">
    <a mat-button class="bg-fiori-primary text-dark px-2 py-1 rounded text-xs">
      <small>Cargar Marcaciones de USB</small>
    </a>
  </div>

  <div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-9">
          <div *ngIf="!isLoading" style="overflow-x: auto">
            <table class="table table-striped table-light table-hover text-sm">
              <thead style="white-space: nowrap">
                <tr>
                  <th style="width: 40px; padding: 0.5rem 0.rem"></th>
                  <th><small>Id Empleado</small></th>
                  <th><small>Nombre</small></th>
                  <th><small>Departamento</small></th>
                  <th><small>Fecha</small></th>
                  <th><small>Hora</small></th>
                  <th><small>Estado</small></th>
                  <th><small>Mascarilla</small></th>
                  <th><small>Temperatura</small></th>
                  <th><small>Área</small></th>
                  <th><small>Número de serie</small></th>
                  <th><small>Dispositivo</small></th>
                  <th><small>Cargar hora</small></th>
                </tr>
              </thead>
              <tbody *ngIf="datosOriginales && datosOriginales.length > 0; else noData">
                <tr *ngFor="let item of datosOriginales; let i = index" style="white-space: nowrap" (click)="updateInfoUserSelect(item)">
                  <td style="padding: 0.1rem">
                    <input type="checkbox" [(ngModel)]="item.Seleccionado" (change)="actualizarSeleccionados()" />
                  </td>
                  <th scope="row" style="padding: 0.1rem"><small>{{ item.idEmpleado }}</small></th>
                  <td style="padding: 0.1rem"><small>{{ item.nombre }}</small></td>
                  <td style="padding: 0.1rem"><small>{{ item.departamento }}</small></td>
                  <td style="padding: 0.1rem"><small>{{ item.fecha | date : "yyyy-MM-dd" }}</small></td>
                  <td style="padding: 0.1rem"><small>{{ item.hora | date : "HH:mm:ss" }}</small></td>
                  <td style="padding: 0.1rem"><small><ng-container *ngIf="item.EstadoMarcacion === 0; else esSalida">Entrada</ng-container><ng-template #esSalida>Salida</ng-template></small></td>
                  <td style="padding: 0.1rem"><small><ng-container *ngIf="item.conMascarilla === 255; else conMask">Desconocido</ng-container><ng-template #conMask>Con Mascarilla</ng-template></small></td>
                  <td style="padding: 0.1rem"><small><ng-container *ngIf="item.temperatura === 255; else conTemp">Desconocido</ng-container><ng-template #conTemp>0</ng-template></small></td>
                  <td style="padding: 0.1rem"><small>{{ item.area }}</small></td>
                  <td style="padding: 0.1rem"><small>{{ item.numeroSerie }}</small></td>
                  <td style="padding: 0.1rem"><small>{{ item.nombreDispositivo }}</small></td>
                  <td style="padding: 0.1rem"><small>{{ item.cargarHora | date : "yyyy-MM-dd HH:mm:ss" }}</small></td>
                </tr>
              </tbody>
              <ng-template #noData>
                <tr>
                  <td colspan="13">No se encontraron datos.</td>
                </tr>
              </ng-template>
            </table>

            <div class="d-flex justify-content-center" *ngIf="totalPaginas > 1">
              <nav aria-label="Page navigation">
                <ul class="pagination">
                  <li class="page-item" [class.disabled]="paginaActual === 1">
                    <a class="page-link" (click)="cambiarPagina(paginaActual - 1)" aria-label="Anterior">
                      <span aria-hidden="true">&laquo;</span>
                    </a>
                  </li>
                  <li class="page-item" *ngIf="mostrarPuntosInicio">
                    <span class="page-link">...</span>
                  </li>
                  <li class="page-item" *ngFor="let pagina of paginasVisibles" [class.active]="pagina === paginaActual">
                    <a class="page-link" (click)="cambiarPagina(pagina)">{{ pagina }}</a>
                  </li>
                  <li class="page-item" *ngIf="mostrarPuntosFinal">
                    <span class="page-link">...</span>
                  </li>
                  <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
                    <a class="page-link" (click)="cambiarPagina(paginaActual + 1)" aria-label="Siguiente">
                      <span aria-hidden="true">&raquo;</span>
                    </a>
                  </li>
                </ul>
              </nav>
            </div>

            <ul id="elementosSeleccionados">
              <li *ngIf="elementosSeleccionados.length > 0">
                Elementos seleccionados: {{ elementosSeleccionados.length }} ({{ elementosSeleccionados.join(", ") }})
              </li>
              <li *ngIf="elementosSeleccionados.length === 0">
                No hay elementos seleccionados.
              </li>
            </ul>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card">
            <div class="card-header">Captura</div>
            <div class="card-body">
              <div class="profile-image" style="height: 150px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                  <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                </svg>
              </div>
              <div *ngIf="datosSeleccionado">
                <div class="text-sm py-1"><strong>ID Empleado:</strong> {{datosSeleccionado.idEmpleado}}</div>
                <div class="text-sm py-1"><strong>Nombre:</strong> {{datosSeleccionado.nombre}}</div>
                <div class="text-sm py-1"><strong>Apellido:</strong> {{datosSeleccionado.apellidos}}</div>
                <div class="text-sm py-1"><strong>Departamento:</strong> {{datosSeleccionado.departamento}}</div>
                <div class="text-sm py-1"><strong>Cargo:</strong> {{datosSeleccionado.cargo}}</div>
                <div class="text-sm py-1"><strong>Fecha de marcación:</strong> {{ datosSeleccionado.timestamp | date:'yyyy-MM-dd' }}</div>
                <div class="text-sm py-1"><strong>Hora de marcación:</strong> {{ datosSeleccionado.timestamp | date:'HH:mm:ss' }}</div>
                <div class="text-sm py-1"><strong>Área:</strong> {{ datosSeleccionado.area }}</div>
                <div class="text-sm py-1"><strong>Número de serie:</strong> {{datosSeleccionado.numeroSerie}}</div>
                <div class="text-sm py-1"><strong>Cargar hora:</strong> {{datosSeleccionado.cargarHora}}</div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
