<app-modal-loading *ngIf="isLoading"></app-modal-loading>

<div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
  {{ errorMessage }}
</div>

<div class="border-bottom container pt-2 mt-2 mb-5">
  <h3 class="mt-2 mt-md-4 mb-3 pt-5">Marcaciones</h3>
  <div class="btn-group btn-group-sm border" role="group" aria-label="Acciones">
    <a mat-button>
      <small>Cargar Marcaciones de USB</small>
    </a>
  </div>

  <div class="mt-2">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-10">
          <div *ngIf="!isLoading" style="overflow-x: auto">
            <table
              class="table table-striped table-light table-hover"
              style="width: 100%; table-layout: auto"
            >
              <thead style="white-space: nowrap">
                <tr>
                  <th style="width: 40px; padding: 0.5rem 0.rem"></th>
                  <th scope="col" style="padding: 0.5rem 0.3rem">
                    <small>Id Empleado</small>
                  </th>
                  <th scope="col" style="padding: 0.5rem 0.3rem"><small>Nombre</small></th>
                  <th scope="col" style="padding: 0.5rem 0.3rem">
                    <small>Departamento</small>
                  </th>
                  <th scope="col" style="padding: 0.5rem 0.3rem"><small>Fecha</small></th>
                  <th scope="col" style="padding: 0.5rem 0.3rem"><small>Hora</small></th>
                  <th scope="col" style="padding: 0.5rem 0.3rem"><small>Estado</small></th>
                  <th scope="col" style="padding: 0.5rem 0.3rem"><small>Mascarilla</small></th>
                  <th scope="col" style="padding: 0.5rem 0.3rem">
                    <small>Temperatura</small>
                  </th>
                  <th scope="col" style="padding: 0.5rem 0.3rem"><small>Área</small></th>
                  <th scope="col" style="padding: 0.5rem 0.3rem">
                   <small> Número de serie</small>
                  </th>
                  <th scope="col" style="padding: 0.5rem 0.3rem">
                    <small>Dispositivo</small>
                  </th>
                  <th scope="col" style="padding: 0.5rem 0.3rem">
                    <small>Cargar hora</small>
                  </th>
                </tr>
              </thead>
              <tbody
                *ngIf="
                  datosOriginales && datosOriginales.length > 0;
                  else noData
                "
              >
                <tr
                  *ngFor="let item of datosOriginales; let i = index"
                  style="white-space: nowrap"
                >
                  <td style="padding: 0.1rem">
                    <input
                      type="checkbox"
                      [(ngModel)]="item.Seleccionado"
                      (change)="actualizarSeleccionados()"
                    />
                  </td>
                  <th scope="row" style="padding: 0.1rem">
                    <small>
                      {{ item.idEmpleado }}
                    </small>
                  </th>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.nombre }}
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.departamento }}
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.fecha | date : "yyyy-MM-dd" }}
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.hora | date : "HH:mm:ss" }}
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      <ng-container
                        *ngIf="item.EstadoMarcacion === 0; else esSalida"
                      >
                        Entrada
                      </ng-container>
                      <ng-template #esSalida> Salida </ng-template>
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      <ng-container
                        *ngIf="item.conMascarilla === 255; else conMask"
                      >
                        Desconocido
                      </ng-container>
                      <ng-template #conMask> Con Mascarilla </ng-template>
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      <ng-container
                        *ngIf="item.temperatura === 255; else conTemp"
                      >
                        Desconocido
                      </ng-container>
                      <ng-template #conTemp> 0 </ng-template>
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.area }}
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.numeroSerie }}
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.nombreDispositivo }}
                    </small>
                  </td>
                  <td style="padding: 0.1rem">
                    <small>
                      {{ item.cargarHora | date : "yyyy-MM-dd HH:mm:ss" }}
                    </small>
                  </td>
                </tr>
              </tbody>
              <ng-template #noData>
                <tr>
                  <td colspan="13">No se encontraron datos.</td>
                </tr>
              </ng-template>
            </table>
            <div
              class="d-flex justify-content-center mt-3"
              *ngIf="totalPaginas > 1"
            >
              <nav aria-label="Page navigation">
                <ul class="pagination">
                  <li class="page-item" [class.disabled]="paginaActual === 1">
                    <a
                      class="page-link"
                      href="#"
                      (click)="cambiarPagina(paginaActual - 1)"
                      aria-label="Anterior"
                    >
                      <span aria-hidden="true">&laquo;</span>
                    </a>
                  </li>
                  <li class="page-item" *ngIf="mostrarPuntosInicio">
                    <span class="page-link">...</span>
                  </li>
                  <li
                    class="page-item"
                    *ngFor="let pagina of paginasVisibles"
                    [class.active]="pagina === paginaActual"
                  >
                    <a
                      class="page-link"
                      href="#"
                      (click)="cambiarPagina(pagina)"
                      >{{ pagina }}</a
                    >
                  </li>
                  <li class="page-item" *ngIf="mostrarPuntosFinal">
                    <span class="page-link">...</span>
                  </li>
                  <li
                    class="page-item"
                    [class.disabled]="paginaActual === totalPaginas"
                  >
                    <a
                      class="page-link"
                      href="#"
                      (click)="cambiarPagina(paginaActual + 1)"
                      aria-label="Siguiente"
                    >
                      <span aria-hidden="true">&raquo;</span>
                    </a>
                  </li>
                </ul>
              </nav>
            </div>
            <ul id="elementosSeleccionados" class="mt-3">
              <li *ngIf="elementosSeleccionados.length > 0">
                Elementos seleccionados: {{ elementosSeleccionados.length }} ({{
                  elementosSeleccionados.join(", ")
                }})
              </li>
              <li *ngIf="elementosSeleccionados.length === 0">
                No hay elementos seleccionados.
              </li>
            </ul>
          </div>
        </div>
        <div class="col-md-2">
          <div>
            <h3>Detalle</h3>
            <p>Aquí podría ir el detalle del elemento seleccionado.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
