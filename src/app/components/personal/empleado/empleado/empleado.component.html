<div class="mx-auto px-4 w-full max-w-7xl space-y-4">

  <!-- Campo de filtro -->
  <div class="flex items-center gap-2 bg-white border rounded-lg shadow-sm p-3">
    <div class="relative flex-1 max-w-sm">
      <input
        type="text"
        [(ngModel)]="filtro"
        placeholder="Buscar empleado por nombre, documento, etc."
        class="w-full px-3 py-2 pr-10 text-sm border border-fiori-border rounded focus:outline-none focus:ring-2 focus:ring-fiori-primary"
        (keyup.enter)="buscarEmpleado()"
      />
      <button 
        class="absolute right-2 top-1/2 transform -translate-y-1/2 text-fiori-subtext hover:text-fiori-primary"
        (click)="buscarEmpleado()"
      >
        <span class="material-icons text-base">search</span>
      </button>
    </div>
    <select
      [(ngModel)]="selectedCategoriaAuxiliar"
      class="px-3 py-2 text-sm border border-fiori-border rounded focus:outline-none focus:ring-2 focus:ring-fiori-primary w-48"
      (change)="onCategoriaAuxiliarChange()"
    >
      <option value="">Todas las sedes</option>
      <option *ngFor="let cat of categoriaAuxiliarList" [value]="cat.categoriaAuxiliarId">
        {{ cat.descripcion }}
      </option>
    </select>
    <select
      [(ngModel)]="selectedRhArea"
      class="px-3 py-2 text-sm border border-fiori-border rounded focus:outline-none focus:ring-2 focus:ring-fiori-primary"
      (change)="onRhAreaChange()"
    >
      <option value="">Todas las áreas</option>
      <option *ngFor="let area of rhAreaList" [value]="area.areaId">
        {{ area.descripcion }}
      </option>
    </select>
  </div>

  <!-- Tabla empleados -->
  <div class="overflow-x-auto card-fiori">
    <table class="min-w-full table-auto text-sm">
      <thead class="bg-fiori-muted text-fiori-subtext">
        <tr>
          <th *ngIf="mostrarBotonAsignar" class="px-2 py-2 text-center w-10 whitespace-nowrap">
            <input type="checkbox" [(ngModel)]="allSelected" (change)="toggleAllEmployees()" />
          </th>
          <th *ngIf="!mostrarBotonAsignar" class="px-2 py-2  whitespace-nowrap w-auto">ID Empleado</th>
          <th class="px-2 py-2  whitespace-nowrap w-auto">Documento</th>
          <th class="px-2 py-2  whitespace-nowrap w-auto">Apellido Paterno</th>
          <th class="px-2 py-2  whitespace-nowrap w-auto">Apellido Materno</th>
          <th class="px-2 py-2  whitespace-nowrap w-auto">Nombres</th>
          <th class="px-2 py-2  whitespace-nowrap w-auto">Sede</th>
          <th class="px-2 py-2  whitespace-nowrap w-auto">Área</th>
          <th *ngIf="mostrarBotonAsignar" class="px-2 py-2 text-center whitespace-nowrap w-auto"></th>
        </tr>
      </thead>
      <tbody  *ngIf="!loading; else skeletonRows">
        <tr  *ngFor="let emp of employees" class="border-t hover:bg-fiori-hover transition">
          <td *ngIf="mostrarBotonAsignar" class="px-2 py-2 text-center">
            <input type="checkbox" [(ngModel)]="emp.selected">
          </td>
          <td *ngIf="!mostrarBotonAsignar" class="px-2 py-2  whitespace-nowrap">{{ emp.personalId }}</td>
          <td class="px-2 py-2 whitespace-nowrap">{{ emp.nroDoc }}</td>
          <td class="px-2 py-2  whitespace-nowrap">{{ emp.apellidoPaterno || '-' }}</td>
          <td class="px-2 py-2  whitespace-nowrap">{{ emp.apellidoMaterno || '-' }}</td>
          <td class="px-2 py-2  whitespace-nowrap">{{ emp.nombres }}</td>
          <td class="px-2 py-2  whitespace-nowrap">{{ emp.categoriaAuxiliarDescripcion || '-' }}</td>
          <td class="px-2 py-2  whitespace-nowrap">{{ emp.areaDescripcion || '-' }}</td>
          <td *ngIf="mostrarBotonAsignar" class="px-2 py-2 text-center whitespace-nowrap">
            <button class="btn-fiori-secondary"  (click)="abrirModalAsignarTurno(emp)" >Asignar</button>
          </td>
        </tr>
        <tr *ngIf="employees.length === 0">
          <td colspan="11" class="text-center py-4 text-fiori-subtext">No se encontraron datos.</td>
        </tr>
      </tbody>
      <ng-template #skeletonRows>
        <tr *ngFor="let skel of skeletonArray">
          <td class="px-4 py-2 text-center"><div class="skeleton h-4 w-4 mx-auto rounded"></div></td>
          <td class="px-4 py-2 text-center"><div class="skeleton h-4 w-20 mx-auto rounded"></div></td>
          <td class="px-4 py-2 text-center"><div class="skeleton h-4 w-16 mx-auto rounded"></div></td>
          <td class="px-4 py-2 text-center"><div class="skeleton h-4 w-20 mx-auto rounded"></div></td>
          <td class="px-4 py-2 text-center"><div class="skeleton h-4 w-28 mx-auto rounded"></div></td>
          <td class="px-4 py-2 text-center"><div class="skeleton h-4 w-16 mx-auto rounded"></div></td>
          <td class="px-4 py-2 text-center"><div class="skeleton h-4 w-24 mx-auto rounded"></div></td>
        </tr>
      </ng-template>
    </table>
  </div>

  <!-- Paginación -->
  <div class="flex justify-between items-center mt-4">
    <div class="text-sm text-fiori-subtext">
      Mostrando {{ totalCount === 0 ? 0 : ((pageNumber - 1) * pageSize + 1) }}
      -
      {{ (pageNumber - 1) * pageSize + employees.length }}
      de {{ totalCount }}
    </div>
    <div class="flex gap-2">
      <button class="btn-fiori-secondary" [disabled]="pageNumber === 1" (click)="changePage(pageNumber - 1)">
        Anterior
      </button>
      <span>Página {{ pageNumber }}</span>
      <button class="btn-fiori-secondary" [disabled]="pageNumber * pageSize >= totalCount" (click)="changePage(pageNumber + 1)">
        Siguiente
      </button>
    </div>
  </div>
</div>
