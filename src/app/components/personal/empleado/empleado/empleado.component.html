<div class="mx-auto px-4 w-full max-w-7xl space-y-4">
  <!-- Campo de filtro -->
  <div class="flex flex-wrap items-center gap-2 bg-white border rounded-lg shadow-sm p-3">
    <div class="relative flex-1 max-w-sm">
      <input
        type="text"
        [(ngModel)]="filtro"
        placeholder="Nombre, documento, etc."
        (keyup.enter)="buscarEmpleado()"
        class="w-full pl-3 pr-10 py-2 border border-fiori-border rounded-lg focus:outline-none focus:ring-1 focus:ring-fiori-primary text-sm"
      />
      <span class="material-icons absolute right-2 top-1/2 -translate-y-1/2 text-fiori-primary cursor-pointer"
            (click)="buscarEmpleado()">search</span>
    </div>
    <select
      [(ngModel)]="selectedCategoriaAuxiliar"
      (change)="onCategoriaAuxiliarChange()"
      class="w-48 px-3 py-2 border border-fiori-border rounded-lg bg-fiori-gray focus:outline-none focus:ring-1 focus:ring-fiori-primary text-sm"
    >
      <option value="">Todas las sedes</option>
      <option *ngFor="let cat of categoriaAuxiliarList" [value]="cat.categoriaAuxiliarId">
        {{ cat.descripcion }}
      </option>
    </select>
    <select
      [(ngModel)]="selectedRhArea"
      (change)="onRhAreaChange()"
      class="w-48 px-3 py-2 border border-fiori-border rounded-lg bg-fiori-gray focus:outline-none focus:ring-1 focus:ring-fiori-primary text-sm"
    >
      <option value="">Todas las áreas</option>
      <option *ngFor="let area of rhAreaList" [value]="area.areaId">
        {{ area.descripcion }}
      </option>
    </select>
    <div class="flex-1"></div>
    <button
      (click)="abrirAsignarTurnoMasivo()"
      class="flex items-center gap-2 px-4 py-2 rounded-full bg-white border shadow text-fiori-primary hover:bg-fiori-primary hover:text-white transition ml-auto"
    >
      <span class="material-icons text-base">schedule</span>
      Asignar turnos
    </button>
  </div>

  <!-- Tabla empleados -->
  <div class="overflow-x-auto card-fiori h-[550px] lg:h-[900px] xl:h-full overflow-y-auto relative">
    <!-- Overlay de loading -->
    <div *ngIf="loading" class="absolute inset-0 z-10 flex items-center justify-center bg-white/70">
      <mat-progress-spinner mode="indeterminate" color="primary" diameter="50"></mat-progress-spinner>
    </div>
    <table mat-table [dataSource]="employees" class="min-w-full text-sm ">
      <ng-container matColumnDef="select">
        <ng-container *ngIf="mostrarBotonAsignar">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox [(ngModel)]="allSelected" (change)="toggleAllEmployees()"></mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let emp">
            <mat-checkbox [(ngModel)]="emp.selected"></mat-checkbox>
          </td>
        </ng-container>
      </ng-container>
      <ng-container matColumnDef="personalId">
        <ng-container *ngIf="!mostrarBotonAsignar">
          <th mat-header-cell *matHeaderCellDef>ID Empleado</th>
          <td mat-cell *matCellDef="let emp">{{ emp.personalId }}</td>
        </ng-container>
      </ng-container>
      <ng-container matColumnDef="nroDoc">
        <th mat-header-cell *matHeaderCellDef>Nro. Doc. Identidad</th>
        <td mat-cell *matCellDef="let emp">{{ emp.nroDoc }}</td>
      </ng-container>
      <ng-container matColumnDef="apellidoPaterno">
        <th mat-header-cell *matHeaderCellDef>Apellido Paterno</th>
        <td mat-cell *matCellDef="let emp">{{ emp.apellidoPaterno || '-' }}</td>
      </ng-container>
      <ng-container matColumnDef="apellidoMaterno">
        <th mat-header-cell *matHeaderCellDef>Apellido Materno</th>
        <td mat-cell *matCellDef="let emp">{{ emp.apellidoMaterno || '-' }}</td>
      </ng-container>
      <ng-container matColumnDef="nombres">
        <th mat-header-cell *matHeaderCellDef>Nombres</th>
        <td mat-cell *matCellDef="let emp">{{ emp.nombres }}</td>
      </ng-container>
      <ng-container matColumnDef="categoriaAuxiliarDescripcion">
        <th mat-header-cell *matHeaderCellDef>Sede</th>
        <td mat-cell *matCellDef="let emp">{{ emp.categoriaAuxiliarDescripcion || '-' }}</td>
      </ng-container>
      <ng-container matColumnDef="areaDescripcion">
        <th mat-header-cell *matHeaderCellDef>Área</th>
        <td mat-cell *matCellDef="let emp">{{ emp.areaDescripcion || '-' }}</td>
      </ng-container>
      <ng-container matColumnDef="asignar">
        <ng-container *ngIf="mostrarBotonAsignar">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let emp">
            <button mat-stroked-button color="primary">Asignar</button>
          </td>
        </ng-container>
      </ng-container>
      <ng-container matColumnDef="acciones">
        <ng-container *ngIf="!mostrarBotonAsignar">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let emp">
            <button 
              mat-icon-button 
              color="primary" 
              (click)="verMarcaciones(emp)"
              matTooltip="Ver marcaciones"
              class="hover:bg-fiori-primary/10">
              <mat-icon>schedule</mat-icon>
            </button>
          </td>
        </ng-container>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <tr *ngIf="employees.length === 0 && !loading">
        <td [attr.colspan]="displayedColumns.length" class="text-center py-8 text-fiori-subtext">
          <div class="flex flex-col items-center justify-center">
            <mat-icon class="mb-2" style="font-size: 48px;">group_off</mat-icon>
            <span class="text-lg font-medium mb-2">No se encontraron empleados</span>
            <span>Prueba con diferentes filtros o añade un nuevo empleado</span>
          </div>
        </td>
      </tr>
    </table>
    <mat-paginator
      [length]="totalCount"
      [pageSize]="pageSize"
      [pageIndex]="page - 1"
      [pageSizeOptions]="[5, 10, 15, 25, 50]"
      (page)="onPageChange($event)">
    </mat-paginator>
  </div>
</div>