<div class="mx-auto max-w-7xl p-4 lg:p-6">
  <!-- Header compacto con información del empleado -->
  <div
    class="bg-fiori-surface border border-fiori-border rounded-lg p-4 mb-4 shadow-fiori"
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div
          class="w-8 h-8 bg-fiori-primary/10 rounded-lg flex items-center justify-center"
        >
          <lucide-icon
            name="user"
            class="text-fiori-primary"
            size="16"
          ></lucide-icon>
        </div>
        <div>
          <h2 class="text-lg font-semibold text-fiori-text">
            {{
              empleado?.nombres ||
                empleado?.nombres + " " + empleado?.apellidoPaterno
            }}
          </h2>
          <p class="text-sm text-fiori-subtext">
            {{ empleado?.nroDoc }} • {{ empleado?.areaDescripcion }}
          </p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <!-- Estadísticas compactas en línea -->
        <div class="flex items-center gap-4 text-sm">
          <div class="flex items-center gap-2">
            <lucide-icon
              name="clock"
              class="text-fiori-primary"
              size="16"
            ></lucide-icon>
            <span class="text-fiori-subtext"
              >{{ marcaciones.length || 0 }} marcaciones</span
            >
          </div>
          <div class="flex items-center gap-2">
            <lucide-icon
              name="calendar"
              class="text-fiori-accent"
              size="16"
            ></lucide-icon>
            <span class="text-fiori-subtext">{{
              fechaInicio && fechaFin ? getDiasRango() + " días" : "Mes actual"
            }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros compactos -->
  <div
    class="bg-fiori-surface rounded-lg shadow-fiori border border-fiori-border mb-4"
  >
    <div class="p-4">
      <form
        class="flex flex-wrap items-center gap-3"
        (ngSubmit)="buscarMarcaciones()"
      >
        <!-- Filtros de fecha en línea -->
        <div class="flex items-center gap-2">
          <lucide-icon
            name="calendar"
            class="text-fiori-primary"
            size="16"
          ></lucide-icon>
          <span class="text-sm font-medium text-fiori-text whitespace-nowrap"
            >Fechas:</span
          >
        </div>

        <div class="relative max-w-sm">
          <lucide-icon
            name="calendar"
            class="absolute left-2 top-1/2 transform -translate-y-1/2 text-fiori-primary"
            size="16"
          ></lucide-icon>
          <input
            id="datepicker-fechaInicio"
            datepicker
            datepicker-format="yyyy-mm-dd"
            type="text"
            datepicker-language="es"
            class="bg-fiori-surface border border-fiori-border text-fiori-text text-sm rounded-lg focus:ring-fiori-primary focus:border-fiori-primary block w-full pl-10 p-2"
            placeholder="Selecciona fecha"
            [ngModel]="fechaInicio"
            (ngModelChange)="fechaInicio = $event"
            name="fechaInicio"
            required
          />
        </div>

        <span class="text-fiori-subtext">hasta</span>

        <div class="relative max-w-sm">
          <lucide-icon
            name="calendar"
            class="absolute left-2 top-1/2 transform -translate-y-1/2 text-fiori-primary"
            size="16"
          ></lucide-icon>
          <input
            id="datepicker-fechaFin"
            datepicker
            datepicker-format="yyyy-mm-dd"
            type="text"
            datepicker-language="es"
            class="bg-fiori-surface border border-fiori-border text-fiori-text text-sm rounded-lg focus:ring-fiori-primary focus:border-fiori-primary block w-full pl-10 p-2"
            placeholder="Selecciona fecha"
            [ngModel]="fechaFin"
            (ngModelChange)="fechaFin = $event"
            name="fechaFin"
            required
          />
        </div>

        <!-- Botones de acción en línea -->
        <div class="flex items-center gap-2 ml-auto">
          <button
            type="submit"
            class="text-white bg-fiori-primary hover:bg-fiori-secondary focus:ring-4 focus:outline-none focus:ring-fiori-primary/30 font-medium rounded-lg text-sm px-4 py-2 flex items-center gap-1.5 transition-colors"
          >
            <lucide-icon name="search" size="14"></lucide-icon>
            Buscar
          </button>

          <button
            type="button"
            (click)="limpiarFiltros()"
            class="text-fiori-subtext hover:text-fiori-text bg-fiori-hover hover:bg-fiori-muted rounded-lg text-sm p-2 transition-colors"
            title="Limpiar filtros"
          >
            <lucide-icon name="refresh-cw" size="14"></lucide-icon>
          </button>

          <div class="h-4 w-px bg-fiori-border"></div>

          <button
            type="button"
            (click)="exportarExcel()"
            class="text-fiori-success hover:text-fiori-success/80 bg-fiori-hover hover:bg-green-50 rounded-lg text-sm p-2 transition-colors"
            title="Exportar Excel"
          >
            <lucide-icon name="file-spreadsheet"></lucide-icon>
          </button>

          <button
            type="button"
            (click)="exportarPDF()"
            class="text-fiori-error hover:text-fiori-error/80 bg-fiori-hover hover:bg-red-50 rounded-lg text-sm p-2 transition-colors"
            title="Exportar PDF"
          >
            <lucide-icon name="file-text" size="14"></lucide-icon>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  <div
    *ngIf="cargando"
    class="bg-fiori-surface rounded-xl shadow-fiori border border-fiori-border p-8"
  >
    <div class="flex flex-col items-center justify-center">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-fiori-primary mb-4"
      ></div>
      <p class="text-fiori-subtext">Cargando marcaciones...</p>
    </div>
  </div>

  <!-- Tabla de marcaciones -->
  <div
    *ngIf="!cargando"
    class="bg-fiori-surface rounded-xl shadow-fiori border border-fiori-border overflow-hidden"
  >
    <!-- Header de la tabla -->
    <div class="bg-fiori-muted px-6 py-4 border-b border-fiori-border">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-fiori-text">
          Marcaciones de Tiempo
        </h3>
        <span class="text-sm text-fiori-subtext"
          >{{ marcaciones.length }} registros encontrados</span
        >
      </div>
    </div>

    <!-- Tabla responsive -->
    <div class="overflow-x-auto" style="max-height: 600px">
      <table
        class="w-full text-sm text-left text-fiori-text"
        *ngIf="marcaciones.length > 0"
      >
        <thead
          class="text-xs text-fiori-subtext uppercase bg-fiori-muted sticky top-0"
        >
          <tr>
            <th scope="col" class="px-6 py-3 font-medium">Documento</th>
            <th scope="col" class="px-6 py-3 font-medium">Fecha y Hora</th>
            <th scope="col" class="px-6 py-3 font-medium">Empleado</th>
            <th scope="col" class="px-6 py-3 font-medium">Área</th>
            <th scope="col" class="px-6 py-3 font-medium">Terminal</th>
            <th scope="col" class="px-6 py-3 font-medium">Horario</th>
            <th scope="col" class="px-6 py-3 font-medium">Día</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let marcacion of marcaciones; trackBy: trackByFn"
            class="bg-fiori-surface border-b border-fiori-border hover:bg-fiori-hover transition-colors"
          >
            <!-- Documento -->
            <td class="px-6 py-4">
              <span
                class="font-mono text-sm bg-fiori-muted px-2 py-1 rounded"
                >{{ marcacion.nroDoc }}</span
              >
            </td>

            <!-- Fecha y Hora -->
            <td class="px-6 py-4">
              <div class="flex flex-col">
                <span class="font-medium text-fiori-text">{{
                  formatearFecha(marcacion.punchTime)
                }}</span>
                <span class="text-sm text-fiori-subtext">{{
                  formatearHora(marcacion.punchTime)
                }}</span>
              </div>
            </td>

            <!-- Empleado -->
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div
                  class="w-8 h-8 bg-fiori-primary/10 rounded-full flex items-center justify-center"
                >
                  <lucide-icon
                    name="user"
                    class="text-fiori-primary"
                    size="16"
                  ></lucide-icon>
                </div>
                <div>
                  <div class="font-medium text-fiori-text">
                    {{ marcacion.nombreCompleto }}
                  </div>
                </div>
              </div>
            </td>

            <!-- Área -->
            <td class="px-6 py-4">
              <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
              >
                <lucide-icon
                  name="building"
                  size="12"
                  class="mr-1"
                ></lucide-icon>
                {{ marcacion.areaDescripcion }}
              </span>
            </td>

            <!-- Terminal -->
            <td class="px-6 py-4">
              <div class="flex flex-col">
                <span class="font-medium text-fiori-text">{{
                  marcacion.terminalAlias
                }}</span>
                <span class="text-sm text-fiori-subtext">{{
                  marcacion.ccostoDescripcion
                }}</span>
              </div>
            </td>

            <!-- Horario -->
            <td class="px-6 py-4">
              <div
                class="flex flex-col"
                *ngIf="marcacion.horarioAlias; else sinHorario"
              >
                <span class="font-medium text-fiori-text">{{
                  marcacion.horarioAlias
                }}</span>
                <div class="flex items-center gap-2 text-xs text-fiori-subtext">
                  <span>{{ marcacion.inTime }}</span>
                  <span>-</span>
                  <span>{{ marcacion.outTime }}</span>
                </div>
              </div>
              <ng-template #sinHorario>
                <span class="text-sm text-fiori-subtext italic"
                  >Sin horario asignado</span
                >
              </ng-template>
            </td>

            <!-- Día -->
            <td class="px-6 py-4">
              <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800"
              >
                {{ marcacion.diaSemanaTexto }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Estado vacío -->
      <div *ngIf="marcaciones.length === 0" class="text-center py-16">
        <div class="flex flex-col items-center gap-4">
          <div
            class="w-16 h-16 bg-fiori-muted rounded-full flex items-center justify-center"
          >
            <lucide-icon
              name="calendar-x"
              class="text-fiori-subtext"
              size="32"
            ></lucide-icon>
          </div>
          <h3 class="text-lg font-medium text-fiori-text">
            {{ mensajeSinMarcaciones || "No se encontraron marcaciones" }}
          </h3>
          <p class="text-fiori-subtext max-w-md">
            {{ getMensajeAyuda() }}
          </p>
          <button
            *ngIf="fechaInicio && fechaFin"
            (click)="reiniciarBusqueda()"
            class="text-white bg-fiori-primary hover:bg-fiori-secondary focus:ring-4 focus:outline-none focus:ring-fiori-primary/30 font-medium rounded-lg text-sm px-5 py-2.5 flex items-center gap-2 mt-4 transition-colors"
          >
            <lucide-icon name="refresh-cw" size="16"></lucide-icon>
            Reintentar búsqueda
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer con información adicional -->
  <div *ngIf="marcaciones.length > 0" class="mt-6 text-center">
    <p class="text-sm text-fiori-subtext">
      Mostrando {{ marcaciones.length }} marcaciones para el período
      seleccionado
    </p>
  </div>
</div>
