<div class="mx-auto max-w-7xl p-4 lg:p-6">
  

  <!-- Filtros compactos -->
  <div
    class="bg-fiori-surface rounded-lg shadow-fiori border border-fiori-border mb-4"
  >
    <div class="p-4">
      <form
        class="flex flex-wrap items-center gap-3"
        (ngSubmit)="buscarMarcaciones()"
      >
        <!-- Filtros de fecha en línea -->
        <div class="flex items-center gap-2">
          <mat-icon class="text-fiori-primary" style="font-size: 16px;">calendar_today</mat-icon>
          <span class="text-sm font-medium text-fiori-text whitespace-nowrap"
            >Fechas:</span
          >
        </div>

        <div class="relative max-w-sm">
          <mat-icon class="absolute left-2 top-1/2 transform -translate-y-1/2 text-fiori-primary pointer-events-none" style="font-size: 16px;">calendar_today</mat-icon>
          <input
            id="fechaInicio"
            type="date"
            class="bg-fiori-surface border border-fiori-border text-fiori-text text-sm rounded-lg focus:ring-fiori-primary focus:border-fiori-primary block w-full pl-10 p-2"
            [ngModel]="fechaInicioStr"
            (ngModelChange)="onFechaInicioChange($event)"
            (change)="onFechaInicioChangeEvent($event)"
            name="fechaInicio"
            required
          />
        </div>

        <span class="text-fiori-subtext">hasta</span>

        <div class="relative max-w-sm">
          <mat-icon class="absolute left-2 top-1/2 transform -translate-y-1/2 text-fiori-primary pointer-events-none" style="font-size: 16px;">calendar_today</mat-icon>
          <input
            id="fechaFin"
            type="date"
            class="bg-fiori-surface border border-fiori-border text-fiori-text text-sm rounded-lg focus:ring-fiori-primary focus:border-fiori-primary block w-full pl-10 p-2"
            [ngModel]="fechaFinStr"
            (ngModelChange)="onFechaFinChange($event)"
            (change)="onFechaFinChangeEvent($event)"
            name="fechaFin"
            required
          />
        </div>

        <!-- Botones de acción en línea -->
        <div class="flex items-center gap-2 ml-auto">
          <button
            type="submit"
            class="text-white bg-fiori-primary hover:bg-fiori-secondary focus:ring-4 focus:outline-none focus:ring-fiori-primary/30 font-medium rounded-lg text-sm px-4 py-2 flex items-center gap-1.5 transition-colors"
          >
            <mat-icon style="font-size: 14px;">search</mat-icon>
            Buscar
          </button>

          <button
            type="button"
            (click)="limpiarFiltros()"
            class="text-fiori-subtext hover:text-fiori-text bg-fiori-hover hover:bg-fiori-muted rounded-lg text-sm p-2 transition-colors"
            title="Limpiar filtros"
          >
            <mat-icon style="font-size: 14px;">refresh</mat-icon>
          </button>

          <div class="h-4 w-px bg-fiori-border"></div>

          <button
            type="button"
            (click)="exportarExcel()"
            class="text-fiori-success hover:text-fiori-success/80 bg-fiori-hover hover:bg-green-50 rounded-lg text-sm p-2 transition-colors"
            title="Exportar Excel"
          >
            <mat-icon>table_view</mat-icon>
          </button>

          <button
            type="button"
            (click)="exportarPDF()"
            class="text-fiori-error hover:text-fiori-error/80 bg-fiori-hover hover:bg-red-50 rounded-lg text-sm p-2 transition-colors"
            title="Exportar PDF"
          >
            <mat-icon style="font-size: 14px;">description</mat-icon>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  <div
    *ngIf="cargando"
    class="bg-fiori-surface rounded-xl shadow-fiori border border-fiori-border p-8"
  >
    <div class="flex flex-col items-center justify-center">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-fiori-primary mb-4"
      ></div>
      <p class="text-fiori-subtext">Cargando marcaciones...</p>
    </div>
  </div>

  <!-- Tabla de marcaciones -->
  <div
    *ngIf="!cargando"
    class="bg-fiori-surface rounded-xl shadow-fiori border border-fiori-border overflow-hidden"
  >
    <!-- Header de la tabla -->
    <div class="bg-fiori-muted px-6 py-4 border-b border-fiori-border">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-fiori-text">
          Marcaciones de Tiempo
        </h3>
        <span class="text-sm text-fiori-subtext"
          >{{ marcaciones.length }} registros encontrados</span
        >
      </div>
    </div>

    <!-- Tabla responsive -->
    <div class="overflow-x-auto" style="max-height: 600px">
      <table
        class="w-full text-sm text-left text-fiori-text"
        *ngIf="marcaciones.length > 0"
      >
        <thead
          class="text-xs text-fiori-subtext uppercase bg-fiori-muted sticky top-0"
        >
          <tr>
            <th scope="col" class="px-6 py-3 font-medium">Documento</th>
            <th scope="col" class="px-6 py-3 font-medium">Fecha y Hora</th>
            <th scope="col" class="px-6 py-3 font-medium">Empleado</th>
            <th scope="col" class="px-6 py-3 font-medium">Área</th>
            <th scope="col" class="px-6 py-3 font-medium">Terminal</th>
            <th scope="col" class="px-6 py-3 font-medium">Horario</th>
            <th scope="col" class="px-6 py-3 font-medium">Día</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let marcacion of marcaciones; trackBy: trackByFn"
            class="bg-fiori-surface border-b border-fiori-border hover:bg-fiori-hover transition-colors"
          >
            <!-- Documento -->
            <td class="px-6 py-4">
              <span
                class="font-mono text-sm bg-fiori-muted px-2 py-1 rounded"
                >{{ marcacion.nroDoc }}</span
              >
            </td>

            <!-- Fecha y Hora -->
            <td class="px-6 py-4">
              <div class="flex flex-col">
                <span class="font-medium text-fiori-text">{{
                  formatearFecha(marcacion.punchTime)
                }}</span>
                <span class="text-sm text-fiori-subtext">{{
                  formatearHora(marcacion.punchTime)
                }}</span>
              </div>
            </td>

            <!-- Empleado -->
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div
                  class="w-8 h-8 bg-fiori-primary/10 rounded-full flex items-center justify-center"
                >
                  <mat-icon class="text-fiori-primary" style="font-size: 16px;">person</mat-icon>
                </div>
                <div>
                  <div class="font-medium text-fiori-text">
                    {{ marcacion.nombreCompleto }}
                  </div>
                </div>
              </div>
            </td>

            <!-- Área -->
            <td class="px-6 py-4">
              <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
              >
                <mat-icon style="font-size: 12px;" class="mr-1">business</mat-icon>
                {{ marcacion.areaDescripcion }}
              </span>
            </td>

            <!-- Terminal -->
            <td class="px-6 py-4">
              <div class="flex flex-col">
                <span class="font-medium text-fiori-text">{{
                  marcacion.terminalAlias
                }}</span>
                <span class="text-sm text-fiori-subtext">{{
                  marcacion.ccostoDescripcion
                }}</span>
              </div>
            </td>

            <!-- Horario -->
            <td class="px-6 py-4">
              <div
                class="flex flex-col"
                *ngIf="marcacion.horarioAlias; else sinHorario"
              >
                <span class="font-medium text-fiori-text">{{
                  marcacion.horarioAlias
                }}</span>
                <div class="flex items-center gap-2 text-xs text-fiori-subtext">
                  <span>{{ marcacion.inTime }}</span>
                  <span>-</span>
                  <span>{{ marcacion.outTime }}</span>
                </div>
              </div>
              <ng-template #sinHorario>
                <span class="text-sm text-fiori-subtext italic"
                  >Sin horario asignado</span
                >
              </ng-template>
            </td>

            <!-- Día -->
            <td class="px-6 py-4">
              <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800"
              >
                {{ marcacion.diaSemanaTexto }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Estado vacío -->
      <div *ngIf="marcaciones.length === 0" class="text-center py-16">
        <div class="flex flex-col items-center gap-4">
          <div
            class="w-16 h-16 bg-fiori-muted rounded-full flex items-center justify-center"
          >
            <mat-icon class="text-fiori-subtext" style="font-size: 32px;">event_busy</mat-icon>
          </div>
          <h3 class="text-lg font-medium text-fiori-text">
            {{ mensajeSinMarcaciones || "No se encontraron marcaciones" }}
          </h3>
          <p class="text-fiori-subtext max-w-md">
            {{ getMensajeAyuda() }}
          </p>
          <button
            *ngIf="fechaInicio && fechaFin"
            (click)="reiniciarBusqueda()"
            class="text-white bg-fiori-primary hover:bg-fiori-secondary focus:ring-4 focus:outline-none focus:ring-fiori-primary/30 font-medium rounded-lg text-sm px-5 py-2.5 flex items-center gap-2 mt-4 transition-colors"
          >
            <mat-icon style="font-size: 16px;">refresh</mat-icon>
            Reintentar búsqueda
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer con información adicional -->
  <div *ngIf="marcaciones.length > 0" class="mt-6 text-center">
    <p class="text-sm text-fiori-subtext">
      Mostrando {{ marcaciones.length }} marcaciones para el período
      seleccionado
    </p>
  </div>
</div>
