<div class="flex flex-col md:flex-row gap-6">
  <!-- Formulario de registro/edición -->
  <div class="md:w-1/3 w-full">
    <div class="card-fiori">
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4 p-6">
        <span class="text-lg font-semibold mb-2 block">{{ editing ? 'Editar' : 'Registrar' }} Usuario-Sede</span>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Usuario</mat-label>
          <mat-select formControlName="userId" required>
            <mat-option *ngFor="let usuario of usuarios" [value]="usuario.userId">{{ usuario.userName }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Sede</mat-label>
          <mat-select formControlName="siteId" required>
            <mat-option *ngFor="let sede of sedes" [value]="sede.categoriaAuxiliarId">{{ sede.descripcion }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Fecha de creación</mat-label>
          <input matInput formControlName="creationDate" type="datetime-local" readonly >
        </mat-form-field>
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Observación</mat-label>
          <textarea matInput formControlName="observation" rows="2"></textarea>
        </mat-form-field>
        <div class="flex gap-2 justify-end">
          <button mat-stroked-button type="button" (click)="cancelEdit()" *ngIf="editing">Cancelar</button>
          <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid || loading">
            {{ editing ? 'Actualizar' : 'Registrar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabla de registros -->
  <div class="md:w-2/3 w-full">
    <div class="card-fiori p-4">
      <span class="text-lg font-semibold mb-4 block">Usuarios por Sede</span>
      <div *ngIf="loading" class="text-center py-8 text-fiori-subtext">Cargando...</div>
      <table mat-table [dataSource]="userSites" class="w-full" *ngIf="!loading">
        <!-- Columnas -->
        <ng-container matColumnDef="userName">
          <th mat-header-cell *matHeaderCellDef>Usuario</th>
          <td mat-cell *matCellDef="let us">{{ us.userName }}</td>
        </ng-container>
        <ng-container matColumnDef="siteName">
          <th mat-header-cell *matHeaderCellDef>Sede</th>
          <td mat-cell *matCellDef="let us">{{ us.siteName }}</td>
        </ng-container>
        <ng-container matColumnDef="observation">
          <th mat-header-cell *matHeaderCellDef>Observación</th>
          <td mat-cell *matCellDef="let us">{{ us.observation }}</td>
        </ng-container>
        <ng-container matColumnDef="active">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let us">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                  [ngClass]="us.active === 'Y' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
              {{ us.active === 'Y' ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let us">
            <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Acciones">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu" class="bg-fiori-background">
              <button mat-menu-item (click)="onEdit(us)" color="primary">
                <mat-icon>edit</mat-icon>
                <span>Editar</span>
              </button>
              <button mat-menu-item (click)="onDelete(us)" color="warn">
                <mat-icon>delete</mat-icon>
                <span>Eliminar</span>
              </button>
              <button mat-menu-item (click)="onToggleActive(us)" color="primary">
                <mat-icon>{{ us.active === 'Y' ? 'block' : 'check_circle' }}</mat-icon>
                <span>{{ us.active === 'Y' ? 'Desactivar' : 'Activar' }}</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>
        <!-- Header y filas -->
        <tr mat-header-row *matHeaderRowDef="['userName','siteName','observation','active','actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['userName','siteName','observation','active','actions']"></tr>
        <!-- Estado vacío -->
        <tr *ngIf="userSites.length === 0 && !loading">
          <td colspan="5" class="text-center text-fiori-subtext py-8">No hay registros</td>
        </tr>
      </table>
    </div>
  </div>
</div>
