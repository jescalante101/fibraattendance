<table class="tabla-nivel nivel-{{ nivel }}">
  <tbody>
    <ng-container *ngFor="let item of datos; let i = index">
      <tr
        [ngStyle]="getEstiloFila(item)"
        (click)="item.subitems?.length ? toggleExpand(item, 'nivel' + nivel + '-item' + i) : null"
      >
        <!-- 1ª Columna con indentación -->
        <td [style.paddingLeft.px]="(nivel - 1) * 40">
          <span *ngIf="item.subitems?.length" class="expand-icon">
            <i class="fa" [ngClass]="item.expandido ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
          </span>
          {{ item.col1 }}
        </td>

        <!-- 2ª, 3ª y 4ª Columnas -->
        <td>{{ item.col2 || '' }}</td>
        <td>{{ item.col3 || '' }}</td>
        <td>{{ item.col4 || '' }}</td>
        <td>{{ item.col5 || '' }}</td>
        <td>{{ item.col6 || '' }}</td>


        <!-- 5ª Columna: solo muestra barra si es nivel 1 -->
        <td class="progreso-col" *ngIf="nivel === 1">
          <div class="barra-container">
            <div
              class="barra"
              [ngStyle]="{ width: item.porcentaje + '%', backgroundColor: getColor(item.porcentaje) }"
            ></div>
            <span class="porcentaje-texto">{{ item.porcentaje }}%</span>
          </div>
        </td>
        <td class="progreso-col" *ngIf="nivel !== 1"></td>
      </tr>

      <!-- Subtabla recursiva -->
      <tr *ngIf="item.expandido && item.subitems?.length">
        <td colspan="7" style="padding: 0; border: none;">
          <app-tabla-nivel [datos]="item.subitems" [nivel]="nivel + 1"></app-tabla-nivel>
        </td>
      </tr>
    </ng-container>
  </tbody>
</table>
